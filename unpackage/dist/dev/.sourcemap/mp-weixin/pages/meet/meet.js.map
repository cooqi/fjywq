{"version":3,"file":"meet.js","sources":["pages/meet/meet.vue","D:/ruanjian/HBuilderX.3.6.18.20230117/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbWVldC9tZWV0LnZ1ZQ"],"sourcesContent":["<template>\n\t<view>\r\n\t\t<view class=\"content\" v-if=\"!userInfo._id\">\r\n\t\t     <view class=\"flex padding justify-center\">\r\n\t\t         <button class=\"cu-btn round bg-red\" @click=\"getUserInfo\">立即登录</button>\r\n\t\t     </view>\r\n\t\t </view>\r\n\t\t<view v-else>\n\t\t<button type=\"primary\" @click=\"choose\" style=\"backgroundColor:#aaa1ce;margin: 10px;\">点这里选择你参加过的青宇公开活动</button>\r\n\t\t<view class=\"tips\">{{tips}}</view>\r\n\t\t<uni-popup ref=\"popup\" background-color=\"#fff\" type=\"bottom\" border-radius=\"10px 10px 0 0\">\r\n\t\t\t<view class=\"popup-content\" >\r\n\t\t\t\t<view v-for=\"(item,index) in meetList\" :key=\"item.value\">\r\n\t\t\t\t\t<uni-data-checkbox  v-model=\"value\" max=\"1\" multiple :localdata=\"[item]\" @change=\"change\" :disabled=\"value.indexOf(item.value)>-1\">\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t</uni-data-checkbox>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"notice\">如缺少场次，请联系我们补充</view>\r\n\t\t\t</view>\r\n\t\t</uni-popup>\r\n\t\t<uni-list :border=\"true\">\r\n\t\t\t\t<uni-list-chat v-for=\"item in my_meet\" :key=\"item._id\" :title=\"item.meet_info.title\" :avatar=\"item.meet_info.img||qy\" :note=\"item.meet_info.content\"  >\r\n\t\t\t\t\t<view class=\"chat-custom-right\">\r\n\t\t\t\t\t\t<text class=\"chat-custom-text del\" @click=\"del(item)\">删除</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</uni-list-chat>\r\n\t\t</uni-list>\r\n\t\t</view>\n\t</view>\n</template>\n\n<script>\r\n\timport qy from '@/static/userImg/qy.jpg'\n\texport default {\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tmeetList:[],\r\n\t\t\t\tmy_meet:[],\r\n\t\t\t\tqy,\r\n\t\t\t\tuserInfo:{},\r\n\t\t\t\tvalue:[]\n\t\t\t}\n\t\t},\r\n\t\tonLoad() {\r\n\t\t\tthis.getList()\r\n\t\t\ttry {\r\n\t\t\t\tconst userInfo = uni.getStorageSync('userInfo');\r\n\t\t\t\tthis.userInfo=JSON.parse(userInfo)\r\n\t\t\t\tthis.getUserMeetList(this.userInfo._id)\r\n\t\t\t} catch (e) {\r\n\t\t\t\t// error\r\n\t\t\t}\r\n\t\t\t\r\n\t\t},\r\n\t\tonShareAppMessage: function () {\r\n\t\t   return {\r\n\t\t     title: '宇青青宇全肯定',\r\n\t\t     path: '/pages/rili/rili'\r\n\t\t   }\r\n\t\t },\r\n\t\t onShareTimeline: function () {\r\n\t\t    return {\r\n\t\t      title: '宇青青宇全肯定'\r\n\t\t    }\r\n\t\t  },\r\n\t\t  onPullDownRefresh() {\r\n\t\t  \tthis.getUserMeetList(this.userInfo._id)\r\n\t\t  },\r\n\t\t  computed:{\r\n\t\t\t  tips(){\r\n\t\t\t\t  \r\n\t\t\t\t  let len =this.my_meet.length\r\n\t\t\t\t  let str=`你已点亮${len}场见面会；`;\r\n\t\t\t\t \r\n\t\t\t\t  if(len===0){\r\n\t\t\t\t\t   str=\"宝子你还未点亮任何见面场次，请添加，如果我们缺少你看得场次，请联系我们！\"\r\n\t\t\t\t  }else if(len>0&&len<3){\r\n\t\t\t\t\t  str+=\"宝子，你已经见过青宇了，太让人嫉妒了\"\r\n\t\t\t\t  }else if(len===this.meetList.length){\r\n\t\t\t\t\t  str+=\"长姐威武，全勤太优秀了！\"\r\n\t\t\t\t  }else{\r\n\t\t\t\t\t  str+=\"你已经打败很多杯杯儿豹豹了，期待下一次见面！\"\r\n\t\t\t\t  }\r\n\t\t\t\t  return str\r\n\t\t\t  }\r\n\t\t  },\n\t\tmethods: {\r\n\t\t\tchoose(){\r\n\t\t\t\tthis.$refs.popup.open()\r\n\t\t\t},\r\n\t\t\tgetUserInfo() {\r\n\t\t\t\tconst _this = this\r\n\t\t\t    uni.getUserProfile({desc: '用于完善会员资料',success: (result) => {\r\n\t\t\t            _this.userInfo = result.userInfo\r\n\t\t\t            _this.wxLogin()\r\n\t\t\t        },fail: () => {\r\n\t\t\t            uni.hideLoading();\r\n\t\t\t            uni.showModal({content: '获取用户信息失败',showCancel: false\r\n\t\t\t            })\r\n\t\t\t        }\r\n\t\t\t    })\r\n\t\t\t},\r\n\t\t\twxLogin() {\r\n\t\t\t\tconst _this = this\r\n\t\t\t    uni.showLoading({title: '加载中' });\r\n\t\t\t\r\n\t\t\t    uni.login({provider: 'weixin',success: (res) => {            // 获取 code\r\n\t\t\t\r\n\t\t\t            if(res.code) {\r\n\t\t\t                uniCloud.callFunction({\r\n\t\t\t\t\t\t\t\tname: 'user',\r\n\t\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\t\taction: 'code2Session',\r\n\t\t\t\t\t\t\t\t\tjs_code: res.code,\r\n\t\t\t\t\t\t\t\t\tuser_info: _this.userInfo,\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t\t\t\tconsole.log('云函数返回的值：：：：', res.result)\r\n\t\t\t                        uni.hideLoading();\r\n\t\t\t\t\t\t\t\t\tif(res.result.result.result._id) {\r\n\t\t\t                            uni.setStorageSync('userInfo', JSON.stringify(res.result.result.result))\r\n\t\t\t                            _this.getUserTodoList(res.result.result.result._id)\r\n\t\t\t                        }\r\n\t\t\t                    },fail: (err) => {\r\n\t\t\t                        uni.hideLoading();\r\n\t\t\t\t\t\t\t\t\tconsole.log('云函数调用失败',err)\r\n\t\t\t                    }\r\n\t\t\t                })\r\n\t\t\t            }\r\n\t\t\t        }\r\n\t\t\t    })\r\n\t\t\t},\n\t\t\tgetList() {\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\ttitle: '处理中...'\r\n\t\t\t\t})\r\n\t\t\t\tuniCloud.callFunction({\r\n\t\t\t\t\tname: 'meet'\r\n\t\t\t\t}).then((res) => {\r\n\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t\tthis.meetList=res.result.data.map(item=>{\r\n\t\t\t\t\t\treturn {text:item.title+' '+item.time+' '+item.bz,value:item._id}\r\n\t\t\t\t\t})\r\n\t\t\t\t}).catch((err) => {\r\n\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\tcontent: `查询失败，错误信息为：${err.message}`,\r\n\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t})\r\n\t\t\t\t\tconsole.error(err)\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tupdateList(data){\r\n\t\t\t\tthis.my_meet=data.map(item=>{\r\n\t\t\t\t\tlet info=item.meetID[0]\r\n\t\t\t\t\tinfo.content=`${info.time} ${info.address} ${info.bz||''}`\r\n\t\t\t\t\titem.meet_info=info\r\n\t\t\t\t\treturn item\r\n\t\t\t\t})\r\n\t\t\t\tthis.value=this.my_meet.map(item=>item.meet_info._id)\r\n\t\t\t},\r\n\t\t\tgetUserMeetList(userid){\r\n\t\t\t\tuni.showLoading({title: '加载中' });\r\n\t\t\t\tuniCloud.callFunction({\r\n\t\t\t\t\tname: 'user-meet',\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tuserID: userid,\r\n\t\t\t\t\t\ttype:'get'\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t        uni.hideLoading();\r\n\t\t\t\t\t\tuni.stopPullDownRefresh();\r\n\t\t\t\t\t\tthis.updateList(res.result.data)\r\n\t\t\t\t    },fail: (err) => {\r\n\t\t\t\t        uni.hideLoading();\r\n\t\t\t\t\t\tuni.stopPullDownRefresh();\r\n\t\t\t\t\t\tconsole.log('云函数调用失败',err)\r\n\t\t\t\t    }\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tchange(e){\r\n\t\t\t\tconsole.log(e)\r\n\t\t\t\tlet val=e.detail.value[0]\r\n\t\t\t\t\r\n\t\t\t\tuni.showLoading({title: '加载中',mask:true });\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tuniCloud.callFunction({\r\n\t\t\t\t\tname: 'user-meet',\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tuserID: this.userInfo._id,\r\n\t\t\t\t\t\tmeetID:val,\r\n\t\t\t\t\t\ttype:'add'\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t        uni.hideLoading();\r\n\t\t\t\t\t\tthis.updateList(res.result.data)\r\n\t\t\t\t    },fail: (err) => {\r\n\t\t\t\t        uni.hideLoading();\r\n\t\t\t\t\t\tconsole.log('云函数调用失败',err)\r\n\t\t\t\t    }\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tdel(item){\r\n\t\t\t\tconst _this=this\r\n\t\t\t\tuni.showModal({\r\n\t\t\t\t\ttitle: '提示',\r\n\t\t\t\t\tcontent: '确认删除',\r\n\t\t\t\t\tsuccess: function (res) {\r\n\t\t\t\t\t\tif (res.confirm) {\r\n\t\t\t\t\t\t\tuni.showLoading({title: '加载中',mask:true });\r\n\t\t\t\t\t\t\tuniCloud.callFunction({\r\n\t\t\t\t\t\t\t\tname: 'user-meet',\r\n\t\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\t\tid:item._id,\r\n\t\t\t\t\t\t\t\t\ttype:'del',\r\n\t\t\t\t\t\t\t\t\tuserID:_this.userInfo._id\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t\t        uni.hideLoading();\r\n\t\t\t\t\t\t\t\t\t_this.updateList(res.result.data)\r\n\t\t\t\t\t\t\t    },fail: (err) => {\r\n\t\t\t\t\t\t\t        uni.hideLoading();\r\n\t\t\t\t\t\t\t\t\tconsole.log('云函数调用失败',err)\r\n\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t} else if (res.cancel) {\r\n\t\t\t\t\t\t\tconsole.log('用户点击取消');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t},\n\t\t}\n\t}\n</script>\n\n<style lang=\"scss\">\n.tips{\r\n\tbackground: rgba(#aaa1ce, 0.2);\r\n\tborder:2px solid #aaa1ce;\r\n\tpadding: 10px;margin: 10px;border-radius: 10px;color: #aaa1ce;\r\n}\r\n.notice{\r\n\tcolor: #aaa1ce;font-size: 13px;text-align: center;margin-top: 5px;\r\n}\r\n.popup-content{\r\n\tpadding:0 10px;\r\n}\r\n.del{\r\n\tfont-size: 13px;color: orange\r\n}\n</style>\n","import MiniProgramPage from 'E:/web/cooqi/fjywq/pages/meet/meet.vue'\nwx.createPage(MiniProgramPage)"],"names":["qy","uni","res"],"mappings":";;;;EAkCE,OAAA;AACC,WAAA;AAAA;;MAGC,IAAAA,cAAA;AAAA;MAEA,OAAA,CAAA;AAAA,IACD;AAAA;EAED,SAAA;;AAEC,QAAA;AACC,YAAA,WAAAC,cAAAA,MAAA,eAAA,UAAA;AACA,WAAA,WAAA,KAAA,MAAA,QAAA;AACA,WAAA,gBAAA,KAAA,SAAA,GAAA;AAAA,IACD,SAAA,GAAA;AAAA,IAEA;AAAA;;AAIE,WAAA;AAAA,MACE,OAAA;AAAA;IAEF;AAAA;;AAGC,WAAA;AAAA,MACE,OAAA;AAAA,IACF;AAAA;EAEF,oBAAA;AACC,SAAA,gBAAA,KAAA,SAAA,GAAA;AAAA;EAED,UAAA;AAAA,IACC,OAAA;;;;AAMG,cAAA;AAAA,MACF,WAAA,MAAA,KAAA,MAAA,GAAA;;MAEA,WAAA,QAAA,KAAA,SAAA,QAAA;AACC,eAAA;AAAA;;MAGD;AACA,aAAA;AAAA,IACD;AAAA;EAEH,SAAA;AAAA,IACC,SAAA;;;;AAIC,YAAA,QAAA;;;;;AAGW,gBAAA,QAAA;AAAA;;AAEAA,wBAAA,MAAA,YAAA;;;;;QAGJ;AAAA;;IAGR,UAAA;AACC,YAAA,QAAA;AACGA,oBAAAA,MAAA,YAAA,EAAA,OAAA,MAAA,CAAA;;;;;;;;gBAQE,QAAA;AAAA,gBACA,SAAA,IAAA;AAAA;;cAGD,SAAA,CAAAC,SAAA;AACCD,8BAAA,MAAA,MAAA,OAAA,8BAAA,eAAAC,KAAA,MAAA;AACkBD,8BAAA,MAAA,YAAA;AAClB,oBAAAC,KAAA,OAAA,OAAA,OAAA,KAAA;AACsBD,sCAAA,eAAA,YAAA,KAAA,UAAAC,KAAA,OAAA,OAAA,MAAA,CAAA;;gBAEJ;AAAA,cACJ;AAAA,cAAA,MAAA,CAAA,QAAA;AACID,8BAAA,MAAA,YAAA;;cAEJ;AAAA;UAER;AAAA,QACJ;AAAA;;IAGR,UAAA;AACCA,oBAAAA,MAAA,YAAA;AAAA;;;;MAKA,CAAA,EAAA,KAAA,CAAA,QAAA;AACCA,sBAAAA,MAAA,YAAA;AACA,aAAA,WAAA,IAAA,OAAA,KAAA,IAAA,UAAA;;;MAGD,CAAA,EAAA,MAAA,CAAA,QAAA;AACCA,sBAAAA,MAAA,YAAA;AACAA,sBAAAA,MAAA,UAAA;AAAA,UACC,SAAA,cAAA,IAAA,OAAA;AAAA,UACA,YAAA;AAAA;;;;IAKH,WAAA,MAAA;;AAEE,YAAA,OAAA,KAAA,OAAA,CAAA;;AAEA,aAAA,YAAA;AACA,eAAA;AAAA;;;;AAKDA,oBAAAA,MAAA,YAAA,EAAA,OAAA,MAAA,CAAA;;QAEC,MAAA;AAAA;;UAGC,MAAA;AAAA;QAED,SAAA,CAAA,QAAA;AACOA,wBAAA,MAAA,YAAA;;AAEN,eAAA,WAAA,IAAA,OAAA,IAAA;AAAA,QACE;AAAA,QAAA,MAAA,CAAA,QAAA;AACIA,wBAAA,MAAA,YAAA;;;QAGJ;AAAA;;IAGL,OAAA,GAAA;AACCA,oBAAAA,MAAA,MAAA,OAAA,8BAAA,CAAA;;AAGAA,oBAAA,MAAA,YAAA,EAAA,OAAA,OAAA,MAAA,KAAA,CAAA;;QAIC,MAAA;AAAA;;;UAIC,MAAA;AAAA;QAED,SAAA,CAAA,QAAA;AACOA,wBAAA,MAAA,YAAA;AACN,eAAA,WAAA,IAAA,OAAA,IAAA;AAAA,QACE;AAAA,QAAA,MAAA,CAAA,QAAA;AACIA,wBAAA,MAAA,YAAA;;QAEJ;AAAA;;IAGL,IAAA,MAAA;AACC,YAAA,QAAA;AACAA,oBAAAA,MAAA,UAAA;AAAA;QAEC,SAAA;AAAA,QACA,SAAA,SAAA,KAAA;AACC,cAAA,IAAA,SAAA;AACCA,0BAAA,MAAA,YAAA,EAAA,OAAA,OAAA,MAAA,KAAA,CAAA;;cAEC,MAAA;AAAA;;;;;cAMA,SAAA,CAAAC,SAAA;AACOD,8BAAA,MAAA,YAAA;AACN,sBAAA,WAAAC,KAAA,OAAA,IAAA;AAAA,cACE;AAAA,cAAA,MAAA,CAAA,QAAA;AACID,8BAAA,MAAA,YAAA;;cAEJ;AAAA;UAEL,WAAA,IAAA,QAAA;;UAEA;AAAA,QACD;AAAA,MACD,CAAA;AAAA;EAGF;AACD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACzOD,GAAG,WAAW,eAAe;"}