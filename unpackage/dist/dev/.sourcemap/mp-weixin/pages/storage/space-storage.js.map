{"version":3,"file":"space-storage.js","sources":["pages/storage/space-storage.vue","D:/ruanjian/HBuilderX.3.6.18.20230117/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvc3RvcmFnZS9zcGFjZS1zdG9yYWdlLnZ1ZQ"],"sourcesContent":["<template>\r\n\t<view class=\"content\">\r\n\t\t<view class=\"title\">直接上传文件到云存储</view>\r\n\t\t<view class=\"tips\">\r\n\t\t\t<text>\r\n\t\t\t\t各个小程序平台运行时，网络相关的 API 在使用前需要配置域名白名单。\r\n\t\t\t</text>\r\n\t\t\t<j-link text=\"参考\" url=\"https://uniapp.dcloud.net.cn/uniCloud/publish.html#useinmp\"></j-link>\r\n\t\t</view>\r\n\t\t<view class=\"btn-list\">\r\n\t\t\t<button type=\"primary\" plain @click=\"chooseImage\">选择文件“后”上传</button>\r\n\t\t\t<text class=\"tips\">先调用uni.chooseImage选完文件/图片/视频后用uniCloud.uploadFile方法上传</text>\r\n\t\t\t<button type=\"primary\" plain @click=\"chooseAndUploadFile()\">选择文件“并”上传</button>\r\n\t\t\t<text class=\"tips\">调用uniCloud.chooseAndUploadFile方法选择文件/图片/视频直接上传</text>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {}\r\n\t\t},\r\n\t\tmounted() {},\r\n\t\tmethods: {\r\n\t\t\tchooseAndUploadFile(file) {\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\ttitle: '文件上传中...'\r\n\t\t\t\t})\r\n\t\t\t\tuniCloud.chooseAndUploadFile({\r\n\t\t\t\t\ttype: 'image',\r\n\t\t\t\t\tonChooseFile: (res) => {\r\n\t\t\t\t\t\tconsole.log(res);\r\n\t\t\t\t\t\tconst processAll = []\r\n\t\t\t\t\t\tfor (let i = 0; i < res.tempFiles.length; i++) {\r\n\t\t\t\t\t\t\tprocessAll.push(this.cropImg(res.tempFiles[i]))\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn Promise.all(processAll).then((fileList) => {\r\n\t\t\t\t\t\t\tlet result = {\r\n\t\t\t\t\t\t\t\ttempFilePaths: []\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tresult.tempFiles = fileList.map((fileItem, index) => {\r\n\t\t\t\t\t\t\t\tresult.tempFilePaths.push(fileItem.path)\r\n\t\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\t\tpath: fileItem.path,\r\n\t\t\t\t\t\t\t\t\tcloudPath: '' + Date.now() + index + '.' + fileItem.ext, // 云端路径，这里随便生成了一个\r\n\t\t\t\t\t\t\t\t\tfileType: fileItem.fileType\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\treturn result\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t}).then(res => {\r\n\t\t\t\t\tconsole.log(res)\r\n\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\tcontent: JSON.stringify(res),\r\n\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t});\r\n\t\t\t\t}).catch((err) => {\r\n\t\t\t\t\tconsole.log(err);\r\n\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\tcontent: JSON.stringify(err),\r\n\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t});\r\n\t\t\t\t}).finally(() => {\r\n\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tcropImg(file) {\r\n\t\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\t\tlet ext\r\n\t\t\t\t\tlet filePathProcessed = file.path // 处理结果\r\n\t\t\t\t\t// #ifdef H5\r\n\t\t\t\t\text = file.name.split('.').pop()\r\n\t\t\t\t\tresolve({\r\n\t\t\t\t\t\tpath: filePathProcessed,\r\n\t\t\t\t\t\text,\r\n\t\t\t\t\t\tfileType: file.fileType\r\n\t\t\t\t\t})\r\n\t\t\t\t\t// #endif\r\n\t\t\t\t\t// #ifndef H5\r\n\t\t\t\t\tuni.getImageInfo({\r\n\t\t\t\t\t\tsrc: file.path,\r\n\t\t\t\t\t\tsuccess(info) {\r\n\t\t\t\t\t\t\text = info.type.toLowerCase()\r\n\t\t\t\t\t\t\tresolve({\r\n\t\t\t\t\t\t\t\tpath: filePathProcessed,\r\n\t\t\t\t\t\t\t\text,\r\n\t\t\t\t\t\t\t\tfileType: file.fileType\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tfail(err) {\r\n\t\t\t\t\t\t\treject(new Error(err.errMsg || '未能获取图片类型'))\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\t// #endif\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tchooseImage() {\r\n\t\t\t\tnew Promise((resolve, reject) => {\r\n\t\t\t\t\tuni.chooseImage({\r\n\t\t\t\t\t\tcount: 1,\r\n\t\t\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t\t\tconst path = res.tempFilePaths[0]\r\n\t\t\t\t\t\t\tlet ext\r\n\t\t\t\t\t\t\t// #ifdef H5\r\n\t\t\t\t\t\t\text = res.tempFiles[0].name.split('.').pop()\r\n\t\t\t\t\t\t\tconst options = {\r\n\t\t\t\t\t\t\t\tfilePath: path,\r\n\t\t\t\t\t\t\t\tcloudPath: Date.now() + '.' + ext\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tresolve(options)\r\n\t\t\t\t\t\t\t// #endif\r\n\t\t\t\t\t\t\t// #ifndef H5\r\n\t\t\t\t\t\t\tuni.getImageInfo({\r\n\t\t\t\t\t\t\t\tsrc: path,\r\n\t\t\t\t\t\t\t\tsuccess(info) {\r\n\t\t\t\t\t\t\t\t\tconst options = {\r\n\t\t\t\t\t\t\t\t\t\tfilePath: path,\r\n\t\t\t\t\t\t\t\t\t\tcloudPath: Date.now() + '.' + info.type.toLowerCase()\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tresolve(options)\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tfail(err) {\r\n\t\t\t\t\t\t\t\t\treject(new Error(err.errMsg || '未能获取图片类型'))\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t// #endif\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tfail: () => {\r\n\t\t\t\t\t\t\treject(new Error('Fail_Cancel'))\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t}).then((options) => {\r\n\t\t\t\t\tthis.uploadFile(options);\r\n\t\t\t\t}).catch((err) => {\r\n\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t\tconsole.log(err);\r\n\t\t\t\t\tif (err.message !== 'Fail_Cancel') {\r\n\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\tcontent: `图片上传失败，错误信息为：${err.message}`,\r\n\t\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tuploadFile(options) {\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\ttitle: '文件上传中...'\r\n\t\t\t\t})\r\n\t\t\t\tuniCloud.uploadFile({\r\n\t\t\t\t\t...options,\r\n\t\t\t\t\tonUploadProgress(e) {\r\n\t\t\t\t\t\tconsole.log(e)\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t// 上传成功后的逻辑\r\n\t\t\t\t\t\tconsole.log(res);\r\n\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\tcontent: '图片上传成功，fileID为：' + res.fileID,\r\n\t\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t\t// 上传失败后的逻辑\r\n\t\t\t\t\t\tconsole.log(err);\r\n\t\t\t\t\t\tif (err.message !== 'Fail_Cancel') {\r\n\t\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\t\tcontent: `图片上传失败，错误信息为：${err.message}`,\r\n\t\t\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcomplete: () => {\r\n\t\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n\t.content {\r\n\t\tpadding-bottom: 30px;\r\n\t}\r\n\r\n\t.title {\r\n\t\tfont-weight: bold;\r\n\t\ttext-align: center;\r\n\t\tpadding: 20px 0px;\r\n\t\tfont-size: 20px;\r\n\t}\r\n\r\n\t.tips {\r\n\t\tcolor: #999999;\r\n\t\tfont-size: 14px;\r\n\t\tpadding: 20px 30px;\r\n\t}\r\n\r\n\t.btn-list {\r\n\t\tpadding: 0px 30px;\r\n\t}\r\n\r\n\t.btn-list button {\r\n\t\tmargin-top: 20px;\r\n\t}\r\n\r\n\t.upload-preview {\r\n\t\twidth: 100%;\r\n\t}\r\n</style>","import MiniProgramPage from 'E:/web/cooqi/fjywq/pages/storage/space-storage.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","uniCloud"],"mappings":"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"}