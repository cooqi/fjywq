{"version":3,"file":"permission-table-compound.js","sources":["pages/clientDB/permission-table-compound/permission-table-compound.vue","D:/ruanjian/HBuilderX.3.6.18.20230117/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvY2xpZW50REIvcGVybWlzc2lvbi10YWJsZS1jb21wb3VuZC9wZXJtaXNzaW9uLXRhYmxlLWNvbXBvdW5kLnZ1ZQ"],"sourcesContent":["<template>\r\n\t<view class=\"page\">\r\n\t\t<view class=\"top-view\">\r\n\t\t\t<uniNoticeBar showIcon=\"true\" iconType=\"info\" text=\"管理员(admin)拥有任何权限,权限控制对其无效。\"></uniNoticeBar>\r\n\t\t\t<uni-segmented-control @clickItem=\"typeIndex = $event.currentIndex\" :current=\"typeIndex\" :values=\"types.map(({text})=>text)\"></uni-segmented-control>\r\n\t\t</view>\r\n\t\t<alertCode ref=\"alertCode\"></alertCode>\r\n\t\t<template v-for=\"(item,index) in permissionList\">\r\n\t\t\t<view class=\"item\" v-if=\"item.exclude !== type\">\r\n\t\t\t\t<view class=\"msg\">{{item.msg}}</view>\r\n\t\t\t\t<text style=\"color: #999999;\">schema路径：uniCloud/database/permission-test-{{index+8}}.schema.json\\n</text>\r\n\t\t\t\t<view class=\"code\">\r\n\t\t\t\t\t配置规则：\r\n\t\t\t\t\t<scroll-view scroll-x class=\"code-box\">\r\n\t\t\t\t\t\t<show-code :codes=\"item.codes[type]\"></show-code>\r\n\t\t\t\t\t</scroll-view>\r\n\t\t\t\t\t<text>含义解释：{{item.explain}}</text>\r\n\t\t\t\t\t<text>【{{types[typeIndex].text}}】</text>\r\n\t\t\t\t\t<text>{{item.explain_end}}</text>\r\n\t\t\t\t</view>\r\n\t\t\t\t<template v-if=\"index===0&&type!='create'\">\r\n\t\t\t\t\t<button type=\"primary\" size=\"mini\" @click=\"myFn({type:'create',index})\">创建数据</button>\r\n\t\t\t\t\t<button type=\"primary\" size=\"mini\" @click=\"myFn({type:'read',index,where:'create_time > '+(Date.now()-60000)})\">{{typeText}}一分钟内的数据</button>\r\n\t\t\t\t</template>\r\n\t\t\t\t<button type=\"primary\" size=\"mini\" plain @click=\"myFn({type,index})\">\r\n\t\t\t\t\t{{types[typeIndex].text}}\r\n\t\t\t\t\t<text v-if=\"type!='create'\">表全部数据</text>\r\n\t\t\t\t\t<text v-else>一条记录</text>\r\n\t\t\t\t</button>\r\n\t\t\t\t<template v-if=\"index===1\">\r\n\t\t\t\t\t<button type=\"primary\" size=\"mini\" @click=\"myFn({type,index,action:'add_view_count'})\">带action{{types[typeIndex].text}}</button>\r\n\t\t\t\t</template>\r\n\t\t\t</view>\r\n\t\t</template>\r\n\t\t<set-permission @change=\"changePermission\"></set-permission>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\tconst db = uniCloud.database()\r\n\timport alertCode from '@/components/alertCode/alertCode.vue';\r\n\timport uniNoticeBar from '@/uni_modules/uni-notice-bar/components/uni-notice-bar/uni-notice-bar.vue'\r\n\texport default {\r\n\t\tcomponents: {\r\n\t\t\tuniNoticeBar,alertCode\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\ttype() {\r\n\t\t\t\treturn this.types[this.typeIndex].value\r\n\t\t\t},\r\n\t\t\ttypeText() {\r\n\t\t\t\treturn this.types[this.typeIndex].text\r\n\t\t\t}\r\n\t\t},\r\n\t\tcreated() {\r\n\t\t\tfor (var j = 0; j < this.types.length; j++) {\r\n\t\t\t\tlet type = this.types[j].value\r\n\t\t\t\tconsole.log(type);\r\n\t\t\t\tfor (let i = 0; i < this.permissionList.length; i++) {\r\n\t\t\t\t\tlet jsonString = `{\r\n\t\t\t\t\t\t\t\"permission\":{\r\n\t\t\t\t\t\t\t\t\"${type}\":\"${this.permissionList[i].code}\"\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t}`\r\n\t\t\t\t\tif(!this.permissionList[i].codes) this.permissionList[i].codes = {}\r\n\t\t\t\t\tthis.permissionList[i].codes[type] = JSON.parse(jsonString)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tconsole.log(this.permissionList);\r\n\t\t},\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tcurrentRole:0,\r\n\t\t\t\ttypes:[\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttext:\"创建\",\r\n\t\t\t\t\t\tvalue:\"create\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttext:\"读取\",\r\n\t\t\t\t\t\tvalue:\"read\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttext:\"更新\",\r\n\t\t\t\t\t\tvalue:\"update\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttext:\"删除\",\r\n\t\t\t\t\t\tvalue:\"delete\"\r\n\t\t\t\t\t}\r\n\t\t\t\t],\r\n\t\t\t\ttypeIndex:0,\r\n\t\t\t\tpermissionList: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t\"msg\": \"交集表达式\",\r\n\t\t\t\t\t\t\"code\": \"doc.create_time > (now - 60000) && 'AUDITOR' in auth.role\",\r\n\t\t\t\t\t\t\"explain\": \"限1分钟内的数据，“且”角色必须为审核员\",\r\n\t\t\t\t\t\t\"exclude\":\"create\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t\"msg\": \"并集表达式\",\r\n\t\t\t\t\t\t\"code\": \"auth.uid != null || 'add_view_count' in action\",\r\n\t\t\t\t\t\t\"explain\": \"限非未登陆的游客，“或”带action\",\r\n\t\t\t\t\t\t\"tableName\":\"permission-test-9\"\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t}\r\n\t\t},\r\n\t\tmounted() {\r\n\t\t\tuni.setStorageSync('uni_id_token', '')\r\n\t\t\tuni.setStorageSync('uni_id_token_expired', '')\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\tasync myFn(e) { // {type:'',tableName:'',index,action:'',where:{}}\r\n\t\t\t\tconsole.log('myFun' + JSON.stringify(e));\r\n\t\t\t\te.where = e.where || {}\r\n\t\t\t\tlet item = this.permissionList[e.index]\r\n\t\t\t\tlet tableName = item.tableName || 'permission-test-' + (e.index + 8)\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\tmask: true\r\n\t\t\t\t});\r\n\t\t\t\r\n\t\t\t\tconsole.log(\r\n\t\t\t\t\t'表名称：' + tableName +\r\n\t\t\t\t\t'\\n 条件：' + JSON.stringify(e.where)\r\n\t\t\t\t);\r\n\t\t\t\r\n\t\t\t\tlet res;\r\n\t\t\t\ttry {\r\n\t\t\t\t\tswitch (e.type) {\r\n\t\t\t\t\t\tcase 'read':\r\n\t\t\t\t\t\t\tres = await db.action(e.action).collection(tableName).where(e.where).get()\r\n\t\t\t\t\t\t\tif(res.result.data.length == 0){\r\n\t\t\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\t\t\ttitle: \"数据为空，请先点击创建数据\",\r\n\t\t\t\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\treturn false\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'create':\r\n\t\t\t\t\t\t\tres = await db.action(e.action).collection(tableName).add({\r\n\t\t\t\t\t\t\t\t\"text\": \"默认写入的数据\" + Date.now()\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'update':\r\n\t\t\t\t\t\t\tres = await db.action(e.action).collection(tableName).where(e.where).update({\r\n\t\t\t\t\t\t\t\t\"text\": \"更新后的数据\" + Date.now()\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'delete':\r\n\t\t\t\t\t\t\tres = await db.action(e.action).collection(tableName).where(e.where).remove()\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\tconsole.log('err 未定义事件类型');\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconsole.log(\"res: \",res);\r\n\t\t\t\t\tthis.$refs.alertCode.open(res.result)\r\n\t\t\t\t} catch (err) {\r\n\t\t\t\t\tconsole.log('TODO handle the exception', err);\r\n\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\ttitle: '错误:' + err.message+','+ err.code,\r\n\t\t\t\t\t\tcontent: item.explain +'【'+ this.typeText+'数据】' + (item.explain_end?item.explain_end:''),\r\n\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t});\r\n\t\t\t\t} finally{\r\n\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tchangePermission(e) {\r\n\t\t\t\tconsole.log(e, '切换完成');\r\n\t\t\t\tconsole.log(\"this.typeIndex: \",this.typeIndex);\r\n\t\t\t\tthis.currentRole = e.role\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style scoped>\r\n\t.top-view{\r\n\t\tbackground-color: #FFFFFF;\r\n\t\tposition: sticky;\r\n\t\ttop: 0;\r\n\t/* #ifdef H5 */\r\n\t\ttop: 44px;\r\n\t/* #endif */\r\n\t\tleft: 0;\r\n\t\tz-index: 999;\r\n\t}\r\n\t.top-view .segmented-control{\r\n\t\tpadding: 0 20rpx;\r\n\t}\r\n\t.item {\r\n\t\tpadding:20rpx 20rpx 0 20rpx;\r\n\t\tborder-bottom: dashed 1px #E9E9EB;\r\n\t}\r\n\t.msg{\r\n\t\tfont-weight: 500;\r\n\t\tfont-size: 16px;\r\n\t}\r\n\t.msg::before{\r\n\t\tcontent:'·';\r\n\t\twidth: 10px;\r\n\t\theight: 10px;\r\n\t\tline-height: 14px;\r\n\t\ttop: 5px;\r\n\t\tposition: relative;\r\n\t\tfont-size: 30px;\r\n\t}\r\n\t.code-box {\r\n\t\tbackground-color: #fffae7;\r\n\t\tpadding: 5px 15px;\r\n\t\twidth: 650rpx;\r\n\t}\r\n\r\n\t.code-box text {\r\n\t\tfont-size: 16px !important;\r\n\t\tcolor: #2b8300 !important;\r\n\t}\r\n\r\n\t.code-box .light {\r\n\t\tcolor: #0077cc !important;\r\n\t}\r\n\r\n\t.code-box .light2 {\r\n\t\tcolor: #009891 !important;\r\n\t}\r\n\r\n\t.navigator {\r\n\t\tpadding: 16rpx;\r\n\t\tcolor: #586b95;\r\n\t}\r\n\r\n\t.page {\r\n\t\tpadding-bottom: 100px;\r\n\t\tbackground-color: #FFFFFF;\r\n\t\tfont-size: 14px;\r\n\t}\r\n\t\r\n\tbutton{\r\n\t\tmargin: 8rpx 16rpx;\r\n\t}\r\n</style>\r\n","import MiniProgramPage from 'E:/web/cooqi/fjywq/pages/clientDB/permission-table-compound/permission-table-compound.vue'\nwx.createPage(MiniProgramPage)"],"names":["uniCloud","uni"],"mappings":";;AAuCC,MAAM,KAAKA,cAAQ,GAAC,SAAS;AAC7B,MAAK,YAAa,MAAW;AAC7B,qBAAqB,MAAW;AAChC,MAAK,YAAU;AAAA,EACd,YAAY;AAAA,IACX;AAAA,IAAa;AAAA,EACb;AAAA,EACD,UAAU;AAAA,IACT,OAAO;AACN,aAAO,KAAK,MAAM,KAAK,SAAS,EAAE;AAAA,IAClC;AAAA,IACD,WAAW;AACV,aAAO,KAAK,MAAM,KAAK,SAAS,EAAE;AAAA,IACnC;AAAA,EACA;AAAA,EACD,UAAU;AACT,aAAS,IAAI,GAAG,IAAI,KAAK,MAAM,QAAQ,KAAK;AAC3C,UAAI,OAAO,KAAK,MAAM,CAAC,EAAE;AACzBC,oBAAAA,MAAY,MAAA,OAAA,gFAAA,IAAI;AAChB,eAAS,IAAI,GAAG,IAAI,KAAK,eAAe,QAAQ,KAAK;AACpD,YAAI,aAAa;AAAA;AAAA,WAEX,IAAI,MAAM,KAAK,eAAe,CAAC,EAAE,IAAI;AAAA;AAAA;AAG3C,YAAG,CAAC,KAAK,eAAe,CAAC,EAAE;AAAO,eAAK,eAAe,CAAC,EAAE,QAAQ,CAAC;AAClE,aAAK,eAAe,CAAC,EAAE,MAAM,IAAI,IAAI,KAAK,MAAM,UAAU;AAAA,MAC3D;AAAA,IACD;AACAA,kBAAA,MAAA,MAAA,OAAA,gFAAY,KAAK,cAAc;AAAA,EAC/B;AAAA,EACD,OAAO;AACN,WAAO;AAAA,MACN,aAAY;AAAA,MACZ,OAAM;AAAA,QACL;AAAA,UACC,MAAK;AAAA,UACL,OAAM;AAAA,QACN;AAAA,QACD;AAAA,UACC,MAAK;AAAA,UACL,OAAM;AAAA,QACN;AAAA,QACD;AAAA,UACC,MAAK;AAAA,UACL,OAAM;AAAA,QACN;AAAA,QACD;AAAA,UACC,MAAK;AAAA,UACL,OAAM;AAAA,QACP;AAAA,MACA;AAAA,MACD,WAAU;AAAA,MACV,gBAAgB;AAAA,QACf;AAAA,UACC,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,WAAW;AAAA,UACX,WAAU;AAAA,QACV;AAAA,QACD;AAAA,UACC,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,WAAW;AAAA,UACX,aAAY;AAAA,QACb;AAAA,MACD;AAAA,IACD;AAAA,EACA;AAAA,EACD,UAAU;AACTA,wBAAI,eAAe,gBAAgB,EAAE;AACrCA,wBAAI,eAAe,wBAAwB,EAAE;AAAA,EAC7C;AAAA,EACD,SAAS;AAAA,IACR,MAAM,KAAK,GAAG;AACbA,0BAAA,MAAA,OAAA,iFAAY,UAAU,KAAK,UAAU,CAAC,CAAC;AACvC,QAAE,QAAQ,EAAE,SAAS,CAAC;AACtB,UAAI,OAAO,KAAK,eAAe,EAAE,KAAK;AACtC,UAAI,YAAY,KAAK,aAAa,sBAAsB,EAAE,QAAQ;AAClEA,oBAAAA,MAAI,YAAY;AAAA,QACf,MAAM;AAAA,MACP,CAAC;AAEDA,0BAAA;AAAA,QAAA;AAAA,QAAA;AAAA,QACC,SAAS,YACT,WAAW,KAAK,UAAU,EAAE,KAAK;AAAA;AAGlC,UAAI;AACJ,UAAI;AACH,gBAAQ,EAAE,MAAI;AAAA,UACb,KAAK;AACJ,kBAAM,MAAM,GAAG,OAAO,EAAE,MAAM,EAAE,WAAW,SAAS,EAAE,MAAM,EAAE,KAAK,EAAE,IAAI;AACzE,gBAAG,IAAI,OAAO,KAAK,UAAU,GAAE;AAC9BA,4BAAAA,MAAI,UAAU;AAAA,gBACb,OAAO;AAAA,gBACP,YAAY;AAAA,cACb,CAAC;AACD,qBAAO;AAAA,YACR;AACA;AAAA,UACD,KAAK;AACJ,kBAAM,MAAM,GAAG,OAAO,EAAE,MAAM,EAAE,WAAW,SAAS,EAAE,IAAI;AAAA,cACzD,QAAQ,YAAY,KAAK,IAAI;AAAA,aAC7B;AACD;AAAA,UACD,KAAK;AACJ,kBAAM,MAAM,GAAG,OAAO,EAAE,MAAM,EAAE,WAAW,SAAS,EAAE,MAAM,EAAE,KAAK,EAAE,OAAO;AAAA,cAC3E,QAAQ,WAAW,KAAK,IAAI;AAAA,aAC5B;AACD;AAAA,UACD,KAAK;AACJ,kBAAM,MAAM,GAAG,OAAO,EAAE,MAAM,EAAE,WAAW,SAAS,EAAE,MAAM,EAAE,KAAK,EAAE,OAAO;AAC5E;AAAA,UACD;AACCA,0BAAAA,MAAA,MAAA,OAAA,iFAAY,aAAa;AACzB;AAAA,QACF;AACAA,sBAAY,MAAA,MAAA,OAAA,iFAAA,SAAQ,GAAG;AACvB,aAAK,MAAM,UAAU,KAAK,IAAI,MAAM;AAAA,MACnC,SAAO,KAAK;AACbA,sBAAA,MAAA,MAAA,OAAA,iFAAY,6BAA6B,GAAG;AAC5CA,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO,QAAQ,IAAI,UAAQ,MAAK,IAAI;AAAA,UACpC,SAAS,KAAK,UAAS,MAAK,KAAK,WAAS,SAAS,KAAK,cAAY,KAAK,cAAY;AAAA,UACrF,YAAY;AAAA,QACb,CAAC;AAAA,MACF,UAAS;AACRA,sBAAAA,MAAI,YAAY;AAAA,MACjB;AAAA,IACA;AAAA,IACD,iBAAiB,GAAG;AACnBA,oBAAA,MAAA,MAAA,OAAA,iFAAY,GAAG,MAAM;AACrBA,oBAAY,MAAA,MAAA,OAAA,iFAAA,oBAAmB,KAAK,SAAS;AAC7C,WAAK,cAAc,EAAE;AAAA,IACtB;AAAA,EACD;AACD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC/KD,GAAG,WAAW,eAAe;"}