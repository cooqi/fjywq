{"version":3,"file":"myTodo.js","sources":["pages/myTodo/myTodo.vue","D:/ruanjian/HBuilderX.3.6.18.20230117/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbXlUb2RvL215VG9kby52dWU"],"sourcesContent":["<template>\r\n\r\n\t   <view class=\"content\" v-if=\"!userInfo._id\">\r\n\t        <view class=\"flex padding justify-center\">\r\n\t            <button class=\"cu-btn round bg-red\" @click=\"getUserInfo\">立即登录</button>\r\n\t        </view>\r\n\t    </view>\r\n\t<view class=\"content\">\r\n\t\t<view v-for=\"(item,index) in todoList\" :key=\"item.value\">\r\n\t\t\t<uni-data-checkbox  v-model=\"todo\" max=\"1\" multiple :localdata=\"[item]\" @change=\"change\" >\r\n\t\t\t\t<template #actions>\r\n\t\t\t\t\t<button class=\"mini-btn\" type=\"warn\" size=\"mini\" @click=\"del(item)\">删除</button>\r\n\t\t\t\t</template>\r\n\t\t\t</uni-data-checkbox>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\ttodo:[],\r\n\t\t\t\tuserInfo:{},\r\n\t\t\t\ttodoList:[],\r\n\t\t\t\toriginTodoList:[],\r\n\t\t\t\t\r\n\t\t\t}\r\n\t\t},\r\n\t\tonLoad() {\r\n\t\t\t\r\n\t\t\ttry {\r\n\t\t\t\tconst userInfo = uni.getStorageSync('userInfo');\r\n\t\t\t\tconsole.log('userInfo',userInfo)\r\n\t\t\t\tthis.userInfo=JSON.parse(userInfo)\r\n\t\t\t\tthis.getUserTodoList(this.userInfo._id)\r\n\t\t\t} catch (e) {\r\n\t\t\t\t// error\r\n\t\t\t}\r\n\t\t},\r\n\t\tonPullDownRefresh() {\r\n\t\t\tthis.getUserTodoList(this.userInfo._id)\r\n\t\t},\r\n\t\t onShareAppMessage: function () {\r\n\t\t    return {\r\n\t\t      title: '宇青青宇全肯定',\r\n\t\t      path: '/pages/cloudFunction/cloudFunction'\r\n\t\t    }\r\n\t\t  },\r\n\t\t  onShareTimeline: function () {\r\n\t\t     return {\r\n\t\t       title: '宇青青宇全肯定'\r\n\t\t     }\r\n\t\t   },\r\n\t\tmethods: {\r\n\t\t\tgetUserInfo() {    \r\n\t\t\t\tconst _this = this\r\n\t\t\t    uni.getUserProfile({desc: '用于完善会员资料',success: (result) => {\r\n\t\t\t            _this.userInfo = result.userInfo\r\n\t\t\t\t\t\tconsole.log(_this.userInfo)\r\n\t\t\t            _this.wxLogin()\r\n\t\t\t        },fail: () => {\r\n\t\t\t            uni.hideLoading();\r\n\t\t\t            uni.showModal({content: '获取用户信息失败',showCancel: false\r\n\t\t\t            })\r\n\t\t\t        }\r\n\t\t\t    })\r\n\t\t\t},\r\n\t\t\twxLogin() {  \r\n\t\t\t\tconst _this = this\r\n\t\t\t    uni.showLoading({title: '加载中' });\r\n\t\t\t\r\n\t\t\t    uni.login({provider: 'weixin',success: (res) => {            // 获取 code\r\n\t\t\t\tconsole.log('login',res)\r\n\t\t\t            if(res.code) {\r\n\t\t\t                uniCloud.callFunction({\r\n\t\t\t\t\t\t\t\tname: 'user',\r\n\t\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\t\taction: 'code2Session',\r\n\t\t\t\t\t\t\t\t\tjs_code: res.code,\r\n\t\t\t\t\t\t\t\t\tuser_info: _this.userInfo,\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t\t\t\tconsole.log('云函数返回的值：：：：', res.result)\r\n\t\t\t                        uni.hideLoading();\r\n\t\t\t\t\t\t\t\t\tif(res.result.result.result._id) {\r\n\t\t\t                            uni.setStorageSync('userInfo', JSON.stringify(res.result.result.result))\r\n\t\t\t                            _this.getUserTodoList(res.result.result.result._id)\r\n\t\t\t                        }\r\n\t\t\t                    },fail: (err) => {\r\n\t\t\t                        uni.hideLoading();\r\n\t\t\t\t\t\t\t\t\tconsole.log('云函数调用失败',err)\r\n\t\t\t                    }\r\n\t\t\t                })\r\n\t\t\t            }\r\n\t\t\t        }\r\n\t\t\t    })\r\n\t\t\t},\r\n\t\t\tupdateList(data){\r\n\t\t\t\tthis.originTodoList=data\r\n\t\t\t\tthis.todoList=data.map(item=>{\r\n\t\t\t\t\treturn {text:item.title,value:item._id,disabled:item.isComplete==='1'}\r\n\t\t\t\t})\r\n\t\t\t\tthis.todo=data.filter(item=>item.isComplete==='1').map(item=>item._id)\r\n\t\r\n\t\t\t},\r\n\t\t\tgetUserTodoList(id){\r\n\t\t\t\tuni.showLoading({title: '加载中' });\r\n\t\t\t\tuniCloud.callFunction({\r\n\t\t\t\t\tname: 'user-todo',\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tuserID: id,\r\n\t\t\t\t\t\ttype:'get'\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t        uni.hideLoading();\r\n\t\t\t\t\t\tuni.stopPullDownRefresh();\r\n\t\t\t\t\t\tthis.updateList(res.result.data)\r\n\t\t\t\t    },fail: (err) => {\r\n\t\t\t\t        uni.hideLoading();\r\n\t\t\t\t\t\tuni.stopPullDownRefresh();\r\n\t\t\t\t\t\tconsole.log('云函数调用失败',err)\r\n\t\t\t\t    }\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tchange(e){\r\n\t\t\t\tconsole.log(e)\r\n\t\t\t\tlet val=e.detail.value[0]\r\n\t\t\t\t\r\n\t\t\t\tuni.showLoading({title: '加载中',mask:true });\r\n\t\t\t\tlet res=this.originTodoList.find(item=>item._id===val)\r\n\t\t\t\tconsole.log('res',res,e)\r\n\t\t\t\tlet data=JSON.parse(JSON.stringify(res))\r\n\t\t\t\tdelete data._id\r\n\t\t\t\tdata.isComplete='1'\r\n\t\t\t\t\r\n\t\t\t\tuniCloud.callFunction({\r\n\t\t\t\t\tname: 'user-todo',\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tid:val,\r\n\t\t\t\t\t\tdata,\r\n\t\t\t\t\t\ttype:'update',\r\n\t\t\t\t\t\tuserID:this.userInfo._id\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t        uni.hideLoading();\r\n\t\t\t\t\t\tthis.updateList(res.result.data)\r\n\t\t\t\t    },fail: (err) => {\r\n\t\t\t\t        uni.hideLoading();\r\n\t\t\t\t\t\tconsole.log('云函数调用失败',err)\r\n\t\t\t\t    }\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tdel(item){\r\n\t\t\t\tconst _this=this\r\n\t\t\t\tuni.showModal({\r\n\t\t\t\t\ttitle: '提示',\r\n\t\t\t\t\tcontent: '确认删除',\r\n\t\t\t\t\tsuccess: function (res) {\r\n\t\t\t\t\t\tif (res.confirm) {\r\n\t\t\t\t\t\t\tuni.showLoading({title: '加载中',mask:true });\r\n\t\t\t\t\t\t\tuniCloud.callFunction({\r\n\t\t\t\t\t\t\t\tname: 'user-todo',\r\n\t\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\t\tid:item.value,\r\n\t\t\t\t\t\t\t\t\ttype:'del',\r\n\t\t\t\t\t\t\t\t\tuserID:_this.userInfo._id\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t\t        uni.hideLoading();\r\n\t\t\t\t\t\t\t\t\t_this.updateList(res.result.data)\r\n\t\t\t\t\t\t\t    },fail: (err) => {\r\n\t\t\t\t\t\t\t        uni.hideLoading();\r\n\t\t\t\t\t\t\t\t\tconsole.log('云函数调用失败',err)\r\n\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t} else if (res.cancel) {\r\n\t\t\t\t\t\t\tconsole.log('用户点击取消');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t},\r\n\t\t\tpageTo(url){\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n\t.content {\r\n\t\tpadding-bottom: 30px;\r\n\t\t.checklist-box{\r\n\t\t\twidth: 100%;\r\n\t\t\tpadding: 10px;\r\n\t\t\t&.is-checked {\r\n\t\t\t\t.checklist-text{\r\n\t\t\t\t\ttext-decoration-line: line-through;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t.tips {\r\n\t\tcolor: #999999;\r\n\t\tfont-size: 14px;\r\n\t\tpadding: 20px 30px;\r\n\t}\r\n\r\n\t.btn-list {\r\n\t\tpadding: 0px 30px;\r\n\t}\r\n\r\n\t.btn-list button {\r\n\t\tmargin-top: 20px;\r\n\t}\r\n\r\n</style>\r\n","import MiniProgramPage from 'E:/web/cooqi/fjywq/pages/myTodo/myTodo.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","res"],"mappings":"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"}