{"version":3,"file":"version_add_detail_mixin.js","sources":["uni_modules/uni-upgrade-center/pages/mixin/version_add_detail_mixin.js"],"sourcesContent":["import {\r\n\tvalidator,\r\n\tenumConverter\r\n} from '@/uni_modules/uni-upgrade-center/js_sdk/validator/opendb-app-versions.js';\r\n\r\nconst platform_iOS = 'iOS';\r\nconst platform_Android = 'Android';\r\n\r\nfunction getValidator(fields) {\r\n\tlet reuslt = {}\r\n\tfor (let key in validator) {\r\n\t\tif (fields.includes(key)) {\r\n\t\t\treuslt[key] = validator[key]\r\n\t\t}\r\n\t}\r\n\treturn reuslt\r\n}\r\n\r\nexport const fields =\r\n\t'appid,name,title,contents,platform,type,version,min_uni_version,url,stable_publish,is_silently,is_mandatory,create_date'\r\n\r\nexport default {\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tlabelWidth: '80px',\r\n\t\t\tenableiOSWgt: true, // 是否开启iOS的wgt更新\r\n\t\t\tsilentlyContent: '静默更新：App升级时会在后台下载wgt包并自行安装。新功能在下次启动App时生效',\r\n\t\t\tmandatoryContent: '强制更新：App升级弹出框不可取消',\r\n\t\t\tstablePublishContent: '同时只可有一个线上发行版，线上发行不可更设为下线。\\n未上线可以设为上线发行并自动替换当前线上发行版',\r\n\t\t\tstablePublishContent2: '使用本包替换当前线上发行版',\r\n\t\t\tuploadFileContent: '可下载安装包地址。上传文件到云存储自动填写，也可以手动填写',\r\n\t\t\tminUniVersionContent: '上次使用新Api或打包新模块的App版本',\r\n\t\t\tpriorityContent: '检查更新时，按照优先级从大到小依次尝试跳转商店。如果都跳转失败，则会打开浏览器使用下载链接下载apk安装包',\r\n\t\t\tlatestStableData: [], // 库中最新已上线版\r\n\t\t\tappFileList: null, // 上传包\r\n\t\t\ttype_valuetotext: enumConverter.type_valuetotext,\r\n\t\t\tpreUrl: '',\r\n\t\t\tformData: {\r\n\t\t\t\t\"appid\": \"\",\r\n\t\t\t\t\"name\": \"\",\r\n\t\t\t\t\"title\": \"\",\r\n\t\t\t\t\"contents\": \"\",\r\n\t\t\t\t\"platform\": [],\r\n\t\t\t\t\"type\": \"\",\r\n\t\t\t\t\"version\": \"\",\r\n\t\t\t\t\"min_uni_version\": \"\",\r\n\t\t\t\t\"url\": \"\",\r\n\t\t\t\t\"stable_publish\": false,\r\n\t\t\t\t\"create_date\": null\r\n\t\t\t},\r\n\t\t\tformOptions: {\r\n\t\t\t\t\"platform_localdata\": [{\r\n\t\t\t\t\t\t\"value\": \"Android\",\r\n\t\t\t\t\t\t\"text\": \"安卓\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t\"value\": \"iOS\",\r\n\t\t\t\t\t\t\"text\": \"苹果\"\r\n\t\t\t\t\t}\r\n\t\t\t\t],\r\n\t\t\t\t\"type_localdata\": [{\r\n\t\t\t\t\t\t\"value\": \"native_app\",\r\n\t\t\t\t\t\t\"text\": \"原生App安装包\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t\"value\": \"wgt\",\r\n\t\t\t\t\t\t\"text\": \"App资源包\"\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t},\r\n\t\t\trules: {\r\n\t\t\t\t...getValidator([\"appid\", \"contents\", \"platform\", \"type\", \"version\", \"min_uni_version\", \"url\",\r\n\t\t\t\t\t\"stable_publish\",\r\n\t\t\t\t\t\"title\", \"name\", \"is_silently\", \"is_mandatory\"\r\n\t\t\t\t])\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\tonReady() {\r\n\t\tthis.$refs.form.setRules(this.rules)\r\n\t},\r\n\tcomputed: {\r\n\t\tisWGT() {\r\n\t\t\treturn this.formData.type === 'wgt'\r\n\t\t},\r\n\t\tisiOS() {\r\n\t\t\treturn !this.isWGT ? this.formData.platform.includes(platform_iOS) : false;\r\n\t\t},\r\n\t\thasPackage() {\r\n\t\t\treturn this.appFileList && !!Object.keys(this.appFileList).length\r\n\t\t},\r\n\t\tfileExtname() {\r\n\t\t\treturn this.isWGT ? ['wgt'] : ['apk']\r\n\t\t},\r\n\t\tplatformLocaldata() {\r\n\t\t\treturn !this.isWGT ? this.formOptions.platform_localdata : this.enableiOSWgt ? this.formOptions\r\n\t\t\t\t.platform_localdata : [this.formOptions.platform_localdata[0]]\r\n\t\t},\r\n\t\tuni_platform() {\r\n\t\t\treturn (this.isiOS ? platform_iOS : platform_Android).toLocaleLowerCase()\r\n\t\t}\r\n\t},\r\n\tmethods: {\r\n\t\tpackageUploadSuccess(res) {\r\n\t\t\tuni.showToast({\r\n\t\t\t\ticon: 'success',\r\n\t\t\t\ttitle: '上传成功',\r\n\t\t\t\tduration: 800\r\n\t\t\t})\r\n\t\t\tthis.preUrl = this.formData.url\r\n\t\t\tthis.formData.url = res.tempFilePaths[0]\r\n\t\t},\r\n\t\tasync packageDelete(res) {\r\n\t\t\tif (!this.hasPackage) return;\r\n\t\t\tlet [deleteRes] = await this.$request('deleteFile', {\r\n\t\t\t\tfileList: [res.tempFilePath]\r\n\t\t\t}, {\r\n\t\t\t\tfunctionName: 'upgrade-center'\r\n\t\t\t})\r\n\t\t\tif (deleteRes.success) {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ticon: 'success',\r\n\t\t\t\t\ttitle: '删除成功',\r\n\t\t\t\t\tduration: 800\r\n\t\t\t\t})\r\n\t\t\t\tthis.formData.url = this.preUrl\r\n\t\t\t\tthis.$refs.form.clearValidate('url')\r\n\t\t\t}\r\n\t\t},\r\n\t\tselectFile() {\r\n\t\t\tif (this.hasPackage) {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\ttitle: '只可上传一个文件，请删除已上传后重试',\r\n\t\t\t\t\tduration: 1000\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\t\tcreateCenterRecord(value) {\r\n\t\t\treturn {\r\n\t\t\t\t...value,\r\n\t\t\t\tuni_platform: this.uni_platform,\r\n\t\t\t\tcreate_env: 'upgrade-center'\r\n\t\t\t}\r\n\t\t},\r\n\t\tcreateCenterQuery({\r\n\t\t\tappid\r\n\t\t}) {\r\n\t\t\treturn {\r\n\t\t\t\tappid,\r\n\t\t\t\tcreate_env: 'upgrade-center'\r\n\t\t\t}\r\n\t\t},\r\n\t\tcreateStatQuery({\r\n\t\t\tappid,\r\n\t\t\ttype,\r\n\t\t\tversion,\r\n\t\t\tuni_platform\r\n\t\t}) {\r\n\t\t\treturn {\r\n\t\t\t\tappid,\r\n\t\t\t\ttype,\r\n\t\t\t\tversion,\r\n\t\t\t\tuni_platform: uni_platform ? uni_platform : this.uni_platform,\r\n\t\t\t\tcreate_env: 'uni-stat',\r\n\t\t\t\tstable_publish: false\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n"],"names":["fields","validator","enumConverter","uni"],"mappings":"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"}