"use strict";const e=require("../../../../common/vendor.js"),t=require("../../js_sdk/validator/opendb-app-versions.js"),a=require("../utils.js"),n=e.tr.database(),i=n.command,s=["name","title","stable_publish","type"];function c(e={}){return{create_env:i.neq("uni-stat"),...e}}const o={data:()=>({backButtonHover:!1,appVersionListDbName:a.appVersionListDbName,currentAppid:"",currentAppName:"",query:"",where:"",orderby:"stable_publish desc,create_date desc",selectedIndexs:[],options:{pageSize:20,pageCurrent:1,...t.enumConverter},imageStyles:{width:64,height:64},loaded:!1,containerTop:{},appList:[],showAppIndex:0}),async onLoad({appid:e}){await this.getAppList(),this.appList.length&&(this.loaded=!0,this.appList.forEach(((t,n)=>{(t.appid===e||a.defaultDisplayApp)&&(this.showAppIndex=n)})),this.setAppInfo(this.showAppIndex),this.where=c({appid:this.currentAppid}))},computed:{...e.mapState("app",["appid"]),appNameList(){return this.appList.map((e=>e.name))}},watch:{showAppIndex(e){this.setAppInfo(e),this.where=c({appid:this.currentAppid})}},onReady(){this.containerTop.height=`${document.documentElement?document.documentElement.clientHeight:window.innerHeight}px`},methods:{setAppInfo(e){this.currentAppid=this.appList[e].appid,this.currentAppName=this.appList[e].name},navigateBack(){e.index.navigateBack()},getWhere(){const e=this.query.trim();if(!e)return"";const t=new RegExp(e,"i");return s.map((e=>t+".test("+e+")")).join(" || ")},search(){const e=this.getWhere(),t=e===this.where;this.where=e,this.where&&(this.where=`(${this.where}) && `),this.where+=`${new RegExp(this.currentAppid,"i")}.test(appid)`,t&&this.loadData()},loadData(e=!0){this.$refs.udb.loadData({clear:e})},onPageChanged(e){this.$refs.udb.loadData({current:e.current})},navigateTo(t,a){e.index.navigateTo({url:t,events:{refreshData:()=>{this.loadData(a)}}})},selectedItems(){var e=this.$refs.udb.dataList;return this.selectedIndexs.map((t=>e[t]._id))},delTable(){this.$refs.udb.remove(this.selectedItems())},selectionChange(e){this.selectedIndexs=e.detail.index},confirmDelete(e){this.$refs.udb.remove(e)},publish(t){const a=Object.keys(this.options.type_valuetotext);e.index.showActionSheet({itemList:Object.values(this.options.type_valuetotext),success:async e=>{this.navigateTo(`./add?appid=${this.currentAppid}&name=${this.currentAppName}&type=${a[e.tapIndex]}`)}})},async getAppList(){try{const{result:e}=await n.collection(a.appListDbName).get();e&&e.data&&e.data.length>0?this.appList=e.data.filter((e=>e.appid!==this.appid)):this.showModalToAppManager()}catch(e){-1===["TOKEN_INVALID_TOKEN_EXPIRED","TOKEN_INVALID_ANONYMOUS_USER"].indexOf(e.code)&&this.showModalToAppManager()}},showModalToAppManager(){let t=null,a=3;function n(){e.index.navigateTo({url:"/pages/system/app/list"}),clearInterval(t)}t=setInterval((()=>{--a<=0&&n()}),1e3),e.index.showModal({title:"请先添加应用",content:"即将跳转至应用管理……",showCancel:!1,confirmText:"立即跳转",success:e=>n()})},store_list_key(e){const t=e?e.filter((e=>e.enable)):[];return t.length?t.sort(((e,t)=>t.priority-e.priority)).map((e=>e.name)).join(","):"-"}}};if(!Array){(e.resolveComponent("uni-icons")+e.resolveComponent("uni-th")+e.resolveComponent("uni-tr")+e.resolveComponent("uni-td")+e.resolveComponent("uni-data-picker")+e.resolveComponent("uni-dateformat")+e.resolveComponent("uni-table")+e.resolveComponent("uni-pagination")+e.resolveComponent("unicloud-db"))()}Math||((()=>"../../../uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../../uni-table/components/uni-th/uni-th.js")+(()=>"../../../uni-table/components/uni-tr/uni-tr.js")+(()=>"../../../uni-table/components/uni-td/uni-td.js")+(()=>"../../../uni-data-picker/components/uni-data-picker/uni-data-picker.js")+(()=>"../../../uni-dateformat/components/uni-dateformat/uni-dateformat.js")+(()=>"../../../uni-table/components/uni-table/uni-table.js")+(()=>"../../../uni-pagination/components/uni-pagination/uni-pagination.js")+(()=>"../../../../node-modules/@dcloudio/uni-components/lib/unicloud-db/unicloud-db.js"))();const p=e._export_sfc(o,[["render",function(t,a,n,i,s,c){return e.e({a:s.loaded},s.loaded?{b:e.t(c.appNameList[s.showAppIndex]),c:e.p({type:"bottom"}),d:e.o((e=>s.showAppIndex=e.detail.value)),e:s.showAppIndex,f:c.appNameList,g:e.o(((...e)=>c.search&&c.search(...e))),h:s.query,i:e.o((e=>s.query=e.detail.value)),j:e.o(((...e)=>c.search&&c.search(...e))),k:e.o(((...e)=>c.publish&&c.publish(...e))),l:!s.selectedIndexs.length,m:e.o(((...e)=>c.delTable&&c.delTable(...e))),n:e.w((({data:t,pagination:a,loading:n,error:i,options:s},o,p)=>({a:"1cce4ada-4-"+p+",1cce4ada-3-"+p,b:"1cce4ada-5-"+p+",1cce4ada-3-"+p,c:"1cce4ada-6-"+p+",1cce4ada-3-"+p,d:"1cce4ada-7-"+p+",1cce4ada-3-"+p,e:"1cce4ada-8-"+p+",1cce4ada-3-"+p,f:"1cce4ada-9-"+p+",1cce4ada-3-"+p,g:"1cce4ada-10-"+p+",1cce4ada-3-"+p,h:"1cce4ada-11-"+p+",1cce4ada-3-"+p,i:"1cce4ada-3-"+p+",1cce4ada-2-"+p,j:e.f(t,((t,a,n)=>({a:e.t(t.appid),b:"1cce4ada-13-"+p+"-"+n+",1cce4ada-12-"+p+"-"+n,c:e.t(t.title||"-"),d:"1cce4ada-14-"+p+"-"+n+",1cce4ada-12-"+p+"-"+n,e:e.t(s.type_valuetotext[t.type]),f:"wgt"===t.type?"#f0f9eb":"#ecf5ff",g:"wgt"===t.type?"#67c23a":"#409eff",h:"1px solid "+("wgt"===t.type?"#e1f3d8":"#d9ecff"),i:"1cce4ada-15-"+p+"-"+n+",1cce4ada-12-"+p+"-"+n,j:"1cce4ada-17-"+p+"-"+n+",1cce4ada-16-"+p+"-"+n,k:e.p({localdata:s.platform_valuetotext,value:t.platform,border:!1,readonly:!0,split:","}),l:"1cce4ada-16-"+p+"-"+n+",1cce4ada-12-"+p+"-"+n,m:e.t(t.version),n:"1cce4ada-18-"+p+"-"+n+",1cce4ada-12-"+p+"-"+n,o:e.t(1==t.stable_publish?"已上线":"已下线"),p:"1cce4ada-19-"+p+"-"+n+",1cce4ada-12-"+p+"-"+n,q:"1cce4ada-21-"+p+"-"+n+",1cce4ada-20-"+p+"-"+n,r:e.p({format:"yyyy-MM-dd hh:mm:ss",date:t.create_date,threshold:[0,0]}),s:"1cce4ada-20-"+p+"-"+n+",1cce4ada-12-"+p+"-"+n,t:e.o((e=>c.navigateTo("./detail?id="+t._id,!1)),a),v:"1cce4ada-22-"+p+"-"+n+",1cce4ada-12-"+p+"-"+n,w:a,x:"1cce4ada-12-"+p+"-"+n+",1cce4ada-2-"+p,y:e.p({disabled:t.stable_publish})}))),k:"1cce4ada-2-"+p+",1cce4ada-1",l:e.p({loading:n,emptyText:i.message||"没有更多数据",border:!0,stripe:!0,type:"selection"}),m:"1cce4ada-23-"+p+",1cce4ada-1",n:e.o((e=>a.current=e)),o:e.p({"show-icon":!0,"page-size":a.size,total:a.count,modelValue:a.current}),p:p,q:o})),{name:"d",path:"n",vueId:"1cce4ada-1"}),o:e.p({align:"center"}),p:e.p({align:"center"}),q:e.p({align:"center"}),r:e.p({align:"center"}),s:e.p({align:"center"}),t:e.p({align:"center"}),v:e.p({align:"center"}),w:e.p({align:"center"}),x:e.p({align:"center"}),y:e.p({align:"center"}),z:e.p({align:"center"}),A:e.p({align:"center"}),B:e.p({align:"center"}),C:e.p({align:"center"}),D:e.p({align:"center"}),E:e.p({align:"center"}),F:e.o(c.selectionChange),G:e.o(c.onPageChanged),H:e.sr("udb","1cce4ada-1"),I:e.p({collection:s.appVersionListDbName,field:"appid,contents,platform,type,version,min_uni_version,url,stable_publish,create_date,title,name",where:s.where,"page-data":"replace",orderby:s.orderby,getcount:!0,"page-size":s.options.pageSize,"page-current":s.options.pageCurrent,options:s.options})}:{J:e.s(s.containerTop)})}]]);wx.createPage(p);
