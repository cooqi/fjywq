"use strict";const t=require("../../common/vendor.js"),e={name:"EmbedCalendar",props:{weekstart:{type:Number,default:7},signedDates:{type:Array,default:()=>[]},open:{type:Boolean,default:!0},avatarSrc:{type:String,default:""},greetingText:{type:String,default:"我闻着饼香来到到街中央"},showTopSection:{type:Boolean,default:!0}},data:()=>({text:{year:"年",month:"月",week:["一","二","三","四","五","六","日"],today:"今"},y:(new Date).getFullYear(),m:(new Date).getMonth(),dates:[],positionTop:0,monthOpen:!0,choose:"",currentWeekIndex:0,selectedDate:null}),created(){let t=new Date;if(this.y=t.getFullYear(),this.m=t.getMonth(),this.dates=this.monthDay(this.y,this.m),this.monthOpen=this.open,!this.open){let t=-1;this.dates.forEach(((e,s)=>{this.isToday(e.year,e.month,e.date)&&(t=s)})),this.positionTop=80*-((Math.ceil((t+1)/7)||1)-1)}},mounted(){let t=new Date,e=t.getFullYear(),s=t.getMonth(),h=t.getDate();this.choose="",this.selectedDate={year:e,month:s,date:h},console.log("初始化完成，无选中状态"),this.monthOpen||this.updateWeekPosition()},computed:{weekDay(){return this.text.week.slice(this.weekstart-1).concat(this.text.week.slice(0,this.weekstart-1))},height(){return this.dates.length/7*80+"upx"}},methods:{monthDay(t,e){let s=new Date(t,e,1).getDay(),h=new Date(t,e+1,0).getDate(),i=new Date(t,e,0).getDate(),a=[],n=7==this.weekstart?0:this.weekstart,o=s==n?0:s>n?s-n:7-n+s,r=7-(o+h)%7;for(let d=1;d<=o;d++)a.push({date:i-o+d,day:n+d-1||7,month:e-1>=0?e-1:12,year:e-1>=0?t:t-1});for(let d=1;d<=h;d++)a.push({date:d,day:d%7+s-1||7,month:e,year:t,lm:!0});for(let d=1;d<=r;d++)a.push({date:d,day:(h+o+n+d-1)%7||7,month:e+1<=11?e+1:0,year:e+1<=11?t:t+1});return a},isSigned(t,e,s){let h=!1;if(!this.signedDates||!Array.isArray(this.signedDates))return console.log("签到数组为空或不是数组:",this.signedDates),h;const i=`${e}-${s}`;for(let a=0;a<this.signedDates.length;a++)if(this.signedDates[a]==i){h=!0;break}return h},isToday(t,e,s){let h=new Date;return t==h.getFullYear()&&e==h.getMonth()&&s==h.getDate()},trgWeek(){if(this.monthOpen=!this.monthOpen,this.monthOpen)this.positionTop=0;else{let t=-1;this.dates.forEach(((e,s)=>{this.isToday(e.year,e.month,e.date)&&(t=s)})),this.positionTop=80*-((Math.ceil((t+1)/7)||1)-1)}},switchToMonth(){this.monthOpen||(this.monthOpen=!0,this.positionTop=0)},switchToWeek(){this.monthOpen&&(this.monthOpen=!1,this.updateSelectedDateToCurrentMonth(),this.updateWeekPosition())},updateWeekPosition(){let t=-1;if(!this.selectedDate){let t=new Date;this.selectedDate={year:t.getFullYear(),month:t.getMonth(),date:t.getDate()}}if(this.updateSelectedDateToCurrentMonth(),this.dates.forEach(((e,s)=>{e.year===this.selectedDate.year&&e.month===this.selectedDate.month&&e.date===this.selectedDate.date&&e.lm&&(t=s)})),-1===t&&this.dates.forEach(((e,s)=>{this.isToday(e.year,e.month,e.date)&&e.lm&&(t=s)})),-1===t){t=0;for(let e=0;e<this.dates.length;e++)if(this.dates[e].lm){t=e;break}}this.currentWeekIndex=Math.floor(t/7),this.positionTop=-80*this.currentWeekIndex},selectOne(t,e){let s=`${t.year}-${t.month+1}-${t.date}`,h=new Date(s);this.selectedDate={year:t.year,month:t.month,date:t.date},h.getMonth()!=this.m&&(this.y=t.year,this.m=t.month,this.dates=this.monthDay(this.y,this.m)),this.choose=s,this.monthOpen||this.updateWeekPosition(),this.$emit("on-click",{date:s,year:t.year,month:t.month+1,day:t.date,isToday:this.isToday(t.year,t.month,t.date)})},turning(t){this.monthOpen?this.turningByMonth(t):this.turningByWeek(t)},turningByMonth(t){"next"===t?this.m+1==12?(this.m=0,this.y=this.y+1):this.m=this.m+1:this.m+1==1?(this.m=11,this.y=this.y-1):this.m=this.m-1,this.dates=this.monthDay(this.y,this.m),this.positionTop=0,this.updateSelectedDateToCurrentMonth(),this.$emit("month-change",{year:this.y,month:this.m+1})},turningByWeek(t){let e=this.getCurrentWeekFirstDay();"next"===t?e.setDate(e.getDate()+7):e.setDate(e.getDate()-7);let s=e.getFullYear(),h=e.getMonth();if(s===this.y&&h===this.m||(this.y=s,this.m=h,this.dates=this.monthDay(this.y,this.m),this.$emit("month-change",{year:this.y,month:this.m+1})),this.selectedDate){let t=new Date(this.selectedDate.year,this.selectedDate.month,this.selectedDate.date).getDay(),s=new Date(e);s.setDate(e.getDate()+(0===t?6:t-1)),this.selectedDate={year:s.getFullYear(),month:s.getMonth(),date:s.getDate()},this.choose=""}this.updateWeekPosition()},getCurrentWeekFirstDay(){let t;t=this.selectedDate?new Date(this.selectedDate.year,this.selectedDate.month,this.selectedDate.date):new Date;let e=t.getDay(),s=0===e?6:e-1,h=new Date(t);return h.setDate(t.getDate()-s),h},updateSelectedDateToCurrentMonth(){if(this.selectedDate){if(this.selectedDate.year!==this.y||this.selectedDate.month!==this.m){let t=new Date(this.y,this.m+1,0).getDate(),e=Math.min(this.selectedDate.date,t);this.selectedDate={year:this.y,month:this.m,date:e},this.choose=""}}else this.selectedDate={year:this.y,month:this.m,date:1}},getSubText(t){return this.isToday(t.year,t.month,t.date)?"今":""},onTodayPlanClick(){this.$emit("today-plan-click");let t=new Date,e=t.getFullYear(),s=t.getMonth(),h=t.getDate();this.y===e&&this.m===s||(this.y=e,this.m=s,this.dates=this.monthDay(this.y,this.m)),this.choose=`${e}-${s+1}-${h}`,this.selectedDate={year:e,month:s,date:h},this.monthOpen||this.updateWeekPosition()},onImageError(t){console.log("头像加载失败:",t)}}};const s=t._export_sfc(e,[["render",function(e,s,h,i,a,n){return t.e({a:h.showTopSection},h.showTopSection?{b:t.t(h.greetingText),c:t.o(((...t)=>n.onTodayPlanClick&&n.onTodayPlanClick(...t)))}:{},{d:t.t(a.y),e:t.t(a.m+1),f:t.o((t=>n.turning("prev"))),g:a.monthOpen?1:"",h:t.o(((...t)=>n.switchToMonth&&n.switchToMonth(...t))),i:a.monthOpen?"":1,j:t.o(((...t)=>n.switchToWeek&&n.switchToWeek(...t))),k:t.o((t=>n.turning("next"))),l:t.f(n.weekDay,((e,s,h)=>({a:t.t(e),b:s}))),m:t.f(a.dates,((e,s,h)=>({a:t.t(e.date),b:a.choose==`${e.year}-${e.month+1}-${e.date}`?1:"",c:n.isToday(e.year,e.month,e.date)&&e.lm?1:"",d:n.isSigned(e.year,e.month+1,e.date)&&e.lm?1:"",e:e.lm?"":1,f:s,g:e.lm?"":1,h:t.o((t=>n.selectOne(e,t)),s)}))),n:`translateY(${a.positionTop}rpx)`,o:a.monthOpen?"":1})}],["__scopeId","data-v-bd831b67"]]);wx.createComponent(s);
