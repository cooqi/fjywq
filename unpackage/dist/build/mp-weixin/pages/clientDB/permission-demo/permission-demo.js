"use strict";const e=require("../../../common/vendor.js"),t=require("../../../js_sdk/validator/permission-test.js"),o=e.tr.database();o.command;function n(e){let o={};for(let n in t.validator)e.indexOf(n)>-1&&(o[n]=t.validator[n]);return o}const a={data:()=>({formData:{_id:!1,nickname:"",username:"",state:0,phone:""},formOptions:{},rules:{...n(["nickname","username","state","phone"])},stateOption:[{text:"审核通过",value:1},{text:"审核拒绝",value:-1}],rulo_index:0,role:""}),mounted(){this.$refs["set-permission"].init(1)},computed:{states(){let e;return[{text:"审核中",value:0},{text:"审核通过",value:1},{text:"审核拒绝",value:-1}].forEach((({text:t,value:o})=>{o==this.formData.state&&(e=t)})),"当前为"+e+"状态。\n"}},methods:{setState(t){console.log(t.detail.value,"permission-test"),o.collection("permission-test").update({state:t.detail.value}).then((o=>{console.log("res: ",o),this.formData.state=t.detail.value,e.index.showToast({icon:"none",title:"更新成功"})})).catch((t=>{console.log(JSON.stringify(t)),e.index.showModal({content:t.message||"请求服务失败",showCancel:!1})})).finally((()=>{e.index.hideLoading()}))},showTip(){e.index.showToast({title:"审核中不能编辑",icon:"none"})},changePermission({role:t,index:n}){console.log("index",n),console.log("role",t),this.role=t,this.rulo_index=n;let a="_id,username,nickname,state",s={};n>0&&(a+=",phone"),1==n&&(s="uid == $env.uid"),o.collection("permission-test").where(s).field(a).get().then((t=>{console.log(t),t.result.data[0]?this.formData=t.result.data[0]:(e.index.showLoading({title:"正在初始化数据",mask:!1}),this.addDefaultData())})).catch((t=>{console.log(t),e.index.hideLoading()}))},submit(){e.index.showLoading({mask:!0}),this.$refs.form.submit().then((e=>{this.submitForm(e)})).catch((t=>{e.index.hideLoading()}))},addDefaultData(){console.log("dbCollectionName: ","permission-test"),o.collection("permission-test").add({nickname:"默认昵称",username:"默认姓名",phone:"1888888888"}).then((t=>{console.log(t),this.formData._id=t.result.id,e.index.showToast({icon:"none",title:"新增成功"}),this.$refs["set-permission"].init(0)})).catch((t=>{console.log(t),e.index.showModal({content:t.message||"请求服务失败",showCancel:!1})})).finally((()=>{e.index.hideLoading()}))},submitForm(t){this.formData._id?(console.log(this.formData.state),0===this.formData.state&&delete t.username,this.rulo_index<=1&&delete t.state,console.log(t),o.action("permission_test_update").collection("permission-test").where("uid == $env.uid").update(t).then((t=>{console.log(JSON.stringify(t.result)),this.rulo_index<=1&&t.result.changeState&&(this.formData.state=0),e.index.showToast({icon:"none",title:"更新成功"})})).catch((t=>{console.log(JSON.stringify(t)),e.index.showModal({content:t.message||"请求服务失败",showCancel:!1})})).finally((()=>{e.index.hideLoading()}))):console.log("err 9527")}}};if(!Array){(e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-forms-item")+e.resolveComponent("uni-data-checkbox")+e.resolveComponent("uni-forms")+e.resolveComponent("set-permission"))()}Math||((()=>"../../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.js")+(()=>"../../../uni_modules/uni-forms/components/uni-forms-item/uni-forms-item.js")+(()=>"../../../uni_modules/uni-data-checkbox/components/uni-data-checkbox/uni-data-checkbox.js")+(()=>"../../../uni_modules/uni-forms/components/uni-forms/uni-forms.js")+(()=>"../../../components/set-permission/set-permission.js"))();const s=e._export_sfc(a,[["render",function(t,o,n,a,s,i){return e.e({a:e.o((e=>s.formData.nickname=e)),b:e.p({disabled:1!=s.rulo_index,modelValue:s.formData.nickname}),c:e.p({name:"nickname",label:"昵称"}),d:e.o((e=>0==s.formData.state?i.showTip():"")),e:e.o((e=>s.formData.username=e)),f:e.p({disabled:1!=s.rulo_index||0==s.formData.state,modelValue:s.formData.username}),g:e.p({name:"username",label:"姓名"}),h:s.rulo_index>0},s.rulo_index>0?e.e({i:s.rulo_index>1},s.rulo_index>1?{j:e.o(i.setState),k:e.p({value:s.formData.state,multiple:!1,localdata:s.stateOption})}:{},{l:e.t(i.states),m:1==s.rulo_index},1==s.rulo_index?e.e({n:s.formData.state},(s.formData.state,{})):{},{o:s.rulo_index>1},s.rulo_index>1?e.e({p:s.formData.state},(s.formData.state,{})):{},{q:e.p({name:"state",label:"状态"})}):{},{r:s.formData.phone},s.formData.phone?{s:e.o((e=>s.formData.phone=e)),t:e.p({disabled:1===!s.rulo_index,modelValue:s.formData.phone})}:{},{v:e.p({name:"phone",label:"电话"}),w:1===s.rulo_index&&s.formData._id},1===s.rulo_index&&s.formData._id?{x:e.o(((...e)=>i.submit&&i.submit(...e)))}:{},{y:e.sr("form","a5d6967a-0"),z:e.p({value:s.formData,"validate-trigger":"submit","err-show-type":"toast"}),A:e.sr("set-permission","a5d6967a-9"),B:e.o(i.changePermission)})}]]);wx.createPage(s);
