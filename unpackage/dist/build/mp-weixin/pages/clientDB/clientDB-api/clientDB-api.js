"use strict";const e=require("../../../common/vendor.js"),t=e.tr.database(),o={data:()=>({msg:{result:{data:""}},pageCurrent:1,pageSize:2}),methods:{addMoreData2TestDb(){e.index.showLoading({mask:!1});let o=[];for(var n=0;n<5;n++)o.push({data:Math.ceil(999*Math.random())});t.collection("test").add(o).then((t=>{this.$refs.alertCode.open(t.result),e.index.hideLoading()}))},addData2TestDb(){e.index.showLoading({mask:!1}),t.collection("test").add({data:Date.now()}).then((t=>{this.$refs.alertCode.open(t.result),e.index.hideLoading()}))},updateData2TestDb(){e.index.showLoading({mask:!1});let o=t.collection("test");o.get({getOne:!0}).then((({result:{data:t}})=>{t?o.doc(t._id).update({data:Date.now()}).then((t=>{console.log(t),this.$refs.alertCode.open(t.result),e.index.hideLoading()})):(e.index.showToast({title:"test表内没有数据",icon:"none"}),e.index.hideLoading())}))},removeData2TestDb(){e.index.showLoading({mask:!1});let o=t.collection("test");o.get({getOne:!0}).then((({result:{data:t}})=>{t?o.doc(t._id).remove().then((t=>{console.log(t),this.$refs.alertCode.open(t.result),e.index.hideLoading()})):(e.index.showToast({title:"test表内没有数据",icon:"none"}),e.index.hideLoading())}))},async removeAllData2TestDb(){e.index.showLoading({mask:!1});let o=t.collection("test"),{result:{data:n}}=await o.get();if(console.log(n),n.length){let{result:{deleted:t}}=await o.where('data!="不存在的条件"').remove();e.index.showToast({title:"成功删除"+t+"条数据！",icon:"none"})}else e.index.showToast({title:"test表内没有数据",icon:"none"}),e.index.hideLoading()},getData(o){console.log(o),e.index.showLoading({mask:!0}),t.collection(o).get().then((e=>{this.$refs.alertCode.open(e.result)})).catch((e=>{console.error(e)})).finally((t=>{e.index.hideLoading()}))},async getOrderByGetTemp(){e.index.showLoading({mask:!0});const o=t.collection("order").field("book_id,quantity").getTemp(),n=t.collection("book").field("_id,author,title").getTemp(),i=await t.collection(o,n).field("book_id as books_info,quantity").get();e.index.hideLoading(),this.$refs.alertCode.open(i.result)},getOrder(){e.index.showLoading({mask:!0}),t.collection("order,book").field("book_id{title,author} as books_info,quantity").get().then((e=>{this.$refs.alertCode.open(e.result)})).catch((e=>{console.error(e)})).finally((()=>{e.index.hideLoading()}))},getOneBook(){e.index.showLoading({mask:!0}),t.collection("book").get({getOne:!0}).then((e=>{this.$refs.alertCode.open(e.result)})).catch((e=>{console.error(e)})).finally((()=>{e.index.hideLoading()}))},getBookTitle(){e.index.showLoading({mask:!0}),t.collection("book").field("title").get().then((e=>{this.$refs.alertCode.open(e.result)})).catch((e=>{console.error(e)})).finally((()=>{e.index.hideLoading()}))},getBookAs(){e.index.showLoading({mask:!0}),t.collection("book").field("title,author as book_author").get().then((e=>{this.$refs.alertCode.open(e.result)})).catch((e=>{console.error(e)})).finally((()=>{e.index.hideLoading()}))},getOrderOrderBy(o){e.index.showLoading({mask:!0}),t.collection("order").orderBy(o).get().then((e=>{this.$refs.alertCode.open(e.result)})).catch((e=>{console.error(e)})).finally((()=>{e.index.hideLoading()}))},getBookHasCount(){e.index.showLoading({mask:!0}),t.collection("book").get({getCount:!0}).then((e=>{this.$refs.alertCode.open(e.result)})).catch((e=>{console.error(e)})).finally((()=>{e.index.hideLoading()}))},getTreeFn(){e.index.showLoading({mask:!0}),t.collection("opendb-department").get({getTree:{limitLevel:10}}).then((e=>{console.log("res: ",e);const t=e.result.data;this.$refs.alertCode.open(t)})).catch((t=>{e.index.showModal({content:t.message||"请求服务失败",showCancel:!1})})).finally((()=>{e.index.hideLoading()}))},async getPageData(){e.index.showLoading({mask:!1});let o=await t.collection("book").skip((this.pageCurrent-1)*this.pageSize).limit(this.pageSize).get();console.log(o),this.$refs.alertCode.open(o.result.data),e.index.hideLoading()}}};if(!Array){(e.resolveComponent("alertCode")+e.resolveComponent("uni-section")+e.resolveComponent("uni-number-box"))()}Math||((()=>"../../../components/alertCode/alertCode.js")+(()=>"../../../components/uni-section/uni-section.js")+(()=>"../../../uni_modules/uni-number-box/components/uni-number-box/uni-number-box.js"))();const n=e._export_sfc(o,[["render",function(t,o,n,i,a,d){return{a:e.sr("alertCode","0b3da402-0"),b:e.p({title:"简单查询",subTitle:"在符合schema设置的前提下,直接在前端查询云端数据库的数据",type:"line"}),c:e.o((e=>d.getData("book"))),d:e.o((e=>d.getData("order"))),e:e.p({title:"查询列表分页",subTitle:"设置每页查询数量和页码查询",type:"line"}),f:e.o((e=>a.pageCurrent=e/1)),g:e.p({min:1,value:a.pageCurrent}),h:e.o((e=>a.pageSize=e/1)),i:e.p({min:1,value:a.pageSize}),j:e.o((e=>d.getPageData("order"))),k:e.p({title:"联表查询-订单和图书",subTitle:"只需在db schema中，将两个表的关联字段建立映射关系，即可实现联表查询。",type:"line"}),l:e.o(((...e)=>d.getOrderByGetTemp&&d.getOrderByGetTemp(...e))),m:e.o(((...e)=>d.getOrder&&d.getOrder(...e))),n:e.p({title:"getOne",subTitle:"使用clientDB时可以在get方法内传入getOne:true来返回一条数据",type:"line"}),o:e.o(((...e)=>d.getOneBook&&d.getOneBook(...e))),p:e.p({title:"getCount",subTitle:"使用clientDB时可以在get方法内传入getCount:true来同时返回总数",type:"line"}),q:e.o(((...e)=>d.getBookHasCount&&d.getBookHasCount(...e))),r:e.p({title:"field",subTitle:"查询时可以使用field方法指定返回字段，在<uni-clientDB>组件中也支持field属性。不使用field方法时会返回所有字段",type:"line"}),s:e.o(((...e)=>d.getBookTitle&&d.getBookTitle(...e))),t:e.p({title:"name as cname",subTitle:"如：author as book_author，意思是将数据库的author字段重命名为book_author",type:"line"}),v:e.o(((...e)=>d.getBookAs&&d.getBookAs(...e))),w:e.p({title:"orderBy",subTitle:"orderBy方法内可以传入一个字符串来指定排序规则。如:订单表order根据quantity销量字段排序",type:"line"}),x:e.o((e=>d.getOrderOrderBy("quantity asc"))),y:e.o((e=>d.getOrderOrderBy("create_date desc"))),z:e.o((e=>d.getOrderOrderBy("quantity asc, create_date desc"))),A:e.p({title:"查询树形数据",subTitle:"树形数据，在数据库里一般不会按照tree的层次来存储，因为按tree结构通过json对象的方式存储不同层级的数据，不利于对tree上的某个节点单独做增删改查。一般存储树形数据，tree上的每个节点都是一条单独的数据表记录，然后通过类似parent_id来表达父子关系。如部门的数据表，里面有2条数据，一条数据记录是“总部”，parent_id为空；另一条数据记录“一级部门A”，parent_id为总部的_id",type:"line"}),B:e.o(((...e)=>d.getTreeFn&&d.getTreeFn(...e))),C:e.p({title:"新增数据记录add",subTitle:"获取到db的表对象后，通过add方法新增数据记录",type:"line"}),D:e.o((e=>d.addData2TestDb())),E:e.o((e=>d.addMoreData2TestDb())),F:e.p({title:"更新数据记录update",subTitle:"collection.doc().update(Object data)",type:"line"}),G:e.o((e=>d.updateData2TestDb())),H:e.p({title:"删除数据记录remove",subTitle:"获取到db的表对象，然后指定要删除的记录，通过remove方法删除。",type:"line"}),I:e.o((e=>d.removeData2TestDb())),J:e.o((e=>d.removeAllData2TestDb()))}}]]);wx.createPage(n);
