"use strict";const e=require("../../common/vendor.js"),a=require("../../js_sdk/validator/user-info.js"),o=e.tr.database();function t(e){let o={};for(let t in a.validator)e.indexOf(t)>-1&&(o[t]=a.validator[t]);return o}const i={data(){let e={username:"",gender:0,birth_date:null,weight:null,mobile:"",email:"",url:"",favorite_book_id:"",address_code:"",party_member:null,hobby:[],comment:""};return{formData:e,formOptions:{gender_localdata:[{text:"未知",value:0},{text:"男",value:1},{text:"女",value:2}],hobby_localdata:[{text:"唱歌",value:"Sing"},{text:"跳舞",value:"dance"},{text:"画画",value:"draw"}]},rules:{...t(Object.keys(e))}}},onLoad(e){if(e.id){const a=e.id;this.formDataId=a,this.getDetail(a)}},onReady(){this.$refs.form.setRules(this.rules)},methods:{submit(){e.index.showLoading({mask:!0}),this.$refs.form.validate().then((e=>{this.submitForm(e)})).catch((()=>{e.index.hideLoading()}))},submitForm(a){o.collection("user-info").doc(this.formDataId).update(a).then((a=>{e.index.showToast({icon:"none",title:"修改成功"}),this.getOpenerEventChannel().emit("refreshData"),setTimeout((()=>e.index.navigateBack()),500)})).catch((a=>{e.index.showModal({content:a.message||"请求服务失败",showCancel:!1})})).finally((()=>{e.index.hideLoading()}))},getDetail(a){e.index.showLoading({mask:!0}),o.collection("user-info").doc(a).field("username,gender,birth_date,weight,mobile,email,url,favorite_book_id,address_code,party_member,hobby,comment").get().then((e=>{const a=e.result.data[0];a&&(this.formData=a)})).catch((a=>{e.index.showModal({content:a.message||"请求服务失败",showCancel:!1})})).finally((()=>{e.index.hideLoading()}))}}};if(!Array){(e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-forms-item")+e.resolveComponent("uni-data-checkbox")+e.resolveComponent("uni-datetime-picker")+e.resolveComponent("uni-data-picker")+e.resolveComponent("uni-forms"))()}Math||((()=>"../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.js")+(()=>"../../uni_modules/uni-forms/components/uni-forms-item/uni-forms-item.js")+(()=>"../../uni_modules/uni-data-checkbox/components/uni-data-checkbox/uni-data-checkbox.js")+(()=>"../../uni_modules/uni-datetime-picker/components/uni-datetime-picker/uni-datetime-picker.js")+(()=>"../../uni_modules/uni-data-picker/components/uni-data-picker/uni-data-picker.js")+(()=>"../../uni_modules/uni-forms/components/uni-forms/uni-forms.js"))();const n=e._export_sfc(i,[["render",function(a,o,t,i,n,l){return{a:e.o((e=>n.formData.username=e)),b:e.p({placeholder:"限制只能输入中文",modelValue:n.formData.username}),c:e.p({name:"username",label:"真实姓名"}),d:e.o((e=>n.formData.gender=e)),e:e.p({localdata:n.formOptions.gender_localdata,modelValue:n.formData.gender}),f:e.p({name:"gender",label:"性别"}),g:e.o((e=>n.formData.birth_date=e)),h:e.p({"return-type":"timestamp",modelValue:n.formData.birth_date}),i:e.p({name:"birth_date",label:"生日"}),j:e.o((e=>n.formData.weight=e)),k:e.p({placeholder:"限输入 >50 && <=500",type:"number",modelValue:n.formData.weight}),l:e.p({name:"weight",label:"体重"}),m:e.o((e=>n.formData.mobile=e)),n:e.p({placeholder:"手机号码",modelValue:n.formData.mobile}),o:e.p({name:"mobile",label:"手机号码"}),p:e.o((e=>n.formData.email=e)),q:e.p({placeholder:"请输入你的邮箱账号",modelValue:n.formData.email}),r:e.p({name:"email",label:"邮箱账号"}),s:e.o((e=>n.formData.url=e)),t:e.p({placeholder:"请输入网址的地址",modelValue:n.formData.url}),v:e.p({name:"url",label:"个人博客"}),w:e.o((e=>n.formData.favorite_book_id=e)),x:e.p({collection:"book",field:"title as text, _id as value",orderby:"desc",modelValue:n.formData.favorite_book_id}),y:e.p({name:"favorite_book_id",label:"喜欢的书"}),z:e.o((e=>n.formData.address_code=e)),A:e.p({"self-field":"code","parent-field":"parent_code",collection:"opendb-city-china",orderby:"value asc",field:"code as value, name as text",modelValue:n.formData.address_code}),B:e.p({name:"address_code",label:"地址"}),C:e.o((e=>a.binddata("party_member",e.detail.value))),D:n.formData.party_member,E:e.p({name:"party_member",label:"是否为党员"}),F:e.o((e=>n.formData.hobby=e)),G:e.p({multiple:"true",multiple:!0,localdata:n.formOptions.hobby_localdata,modelValue:n.formData.hobby}),H:e.p({name:"hobby",label:"业余爱好"}),I:e.o([e=>n.formData.comment=e.detail.value,e=>a.binddata("comment",e.detail.value)]),J:n.formData.comment,K:e.p({name:"comment",label:"备注"}),L:e.o(((...e)=>l.submit&&l.submit(...e))),M:e.sr("form","cea90042-0"),N:e.p({value:n.formData,"validate-trigger":"submit","err-show-type":"toast"})}}]]);wx.createPage(n);
