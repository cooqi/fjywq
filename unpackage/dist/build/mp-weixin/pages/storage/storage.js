"use strict";const e=require("../../common/vendor.js"),o={data:()=>({todo:[],userInfo:{},todoList:[],originTodoList:[]}),onLoad(){let o=e.index.getStorage("userInfo");console.log("userInfo",o)},onShareAppMessage:function(){return{title:"宇青青宇全肯定",path:"/pages/cloudFunction/cloudFunction"}},onShareTimeline:function(){return{title:"宇青青宇全肯定"}},methods:{getUserInfo(){const o=this;e.index.getUserProfile({desc:"用于完善会员资料",success:e=>{o.userInfo=e.userInfo,console.log(o.userInfo),o.wxLogin()},fail:()=>{e.index.hideLoading(),e.index.showModal({content:"获取用户信息失败",showCancel:!1})}})},wxLogin(){const o=this;e.index.showLoading({title:"加载中"}),e.index.login({provider:"weixin",success:t=>{console.log("login",t),t.code&&e.tr.callFunction({name:"user",data:{action:"code2Session",js_code:t.code,user_info:o.userInfo},success:t=>{console.log("云函数返回的值：：：：",t.result),e.index.hideLoading(),t.result.result.result._id&&(e.index.setStorageSync("userInfo",JSON.stringify(t.result.result.result)),o.getUserTodoList(t.result.result.result._id))},fail:o=>{e.index.hideLoading(),console.log("云函数调用失败",o)}})}})},updateList(e){this.originTodoList=e,this.todoList=e.map((e=>({text:e.title,value:e._id,disabled:"1"===e.isComplete}))),this.todo=e.filter((e=>"1"===e.isComplete)).map((e=>e._id))},getUserTodoList(o){e.index.showLoading({title:"加载中"}),e.tr.callFunction({name:"user-todo",data:{userID:o,type:"get"},success:o=>{e.index.hideLoading(),this.updateList(o.result.data)},fail:o=>{e.index.hideLoading(),console.log("云函数调用失败",o)}})},change(o){console.log(o);let t=o.detail.value[0];e.index.showLoading({title:"加载中"});let i=this.originTodoList.find((e=>e._id===t));console.log("data",i,o),delete i._id,i.isComplete="1",e.tr.callFunction({name:"user-todo",data:{id:t,data:i,type:"update"},success:o=>{e.index.hideLoading(),this.updateList(o.result.data)},fail:o=>{e.index.hideLoading(),console.log("云函数调用失败",o)}})},pageTo(o){e.index.navigateTo({url:o})}}};const t=e._export_sfc(o,[["render",function(e,o,t,i,s,n){return{}}]]);o.__runtimeHooks=6,wx.createPage(t);
