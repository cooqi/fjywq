"use strict";const e=require("../../common/vendor.js"),o={data:()=>({}),mounted(){},methods:{chooseAndUploadFile(o){e.index.showLoading({title:"文件上传中..."}),e.tr.chooseAndUploadFile({type:"image",onChooseFile:e=>{console.log(e);const o=[];for(let n=0;n<e.tempFiles.length;n++)o.push(this.cropImg(e.tempFiles[n]));return Promise.all(o).then((e=>{let o={tempFilePaths:[]};return o.tempFiles=e.map(((e,n)=>(o.tempFilePaths.push(e.path),{path:e.path,cloudPath:""+Date.now()+n+"."+e.ext,fileType:e.fileType}))),o}))}}).then((o=>{console.log(o),e.index.showModal({content:JSON.stringify(o),showCancel:!1})})).catch((o=>{console.log(o),e.index.showModal({content:JSON.stringify(o),showCancel:!1})})).finally((()=>{e.index.hideLoading()}))},cropImg:o=>new Promise(((n,s)=>{let t,l=o.path;e.index.getImageInfo({src:o.path,success(e){t=e.type.toLowerCase(),n({path:l,ext:t,fileType:o.fileType})},fail(e){s(new Error(e.errMsg||"未能获取图片类型"))}})})),chooseImage(){new Promise(((o,n)=>{e.index.chooseImage({count:1,success:s=>{const t=s.tempFilePaths[0];e.index.getImageInfo({src:t,success(e){const n={filePath:t,cloudPath:Date.now()+"."+e.type.toLowerCase()};o(n)},fail(e){n(new Error(e.errMsg||"未能获取图片类型"))}})},fail:()=>{n(new Error("Fail_Cancel"))}})})).then((e=>{this.uploadFile(e)})).catch((o=>{e.index.hideLoading(),console.log(o),"Fail_Cancel"!==o.message&&e.index.showModal({content:`图片上传失败，错误信息为：${o.message}`,showCancel:!1})}))},uploadFile(o){e.index.showLoading({title:"文件上传中..."}),e.tr.uploadFile({...o,onUploadProgress(e){console.log(e)},success:o=>{console.log(o),e.index.showModal({content:"图片上传成功，fileID为："+o.fileID,showCancel:!1})},fail:o=>{console.log(o),"Fail_Cancel"!==o.message&&e.index.showModal({content:`图片上传失败，错误信息为：${o.message}`,showCancel:!1})},complete:()=>{e.index.hideLoading()}})}}};if(!Array){e.resolveComponent("j-link")()}Math;const n=e._export_sfc(o,[["render",function(o,n,s,t,l,a){return{a:e.p({text:"参考",url:"https://uniapp.dcloud.net.cn/uniCloud/publish.html#useinmp"}),b:e.o(((...e)=>a.chooseImage&&a.chooseImage(...e))),c:e.o((e=>a.chooseAndUploadFile()))}}]]);wx.createPage(n);
