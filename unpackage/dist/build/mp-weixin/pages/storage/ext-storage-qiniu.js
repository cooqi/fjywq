"use strict";const e=require("../../common/vendor.js"),o={data:()=>({privateFileID:""}),mounted(){},methods:{chooseImage(o){new Promise(((o,t)=>{e.index.chooseImage({count:1,success:i=>{const s=i.tempFilePaths[0];e.index.getImageInfo({src:s,success(e){const t={filePath:s,cloudPath:Date.now()+"."+e.type.toLowerCase()};o(t)},fail(e){t(new Error(e.errMsg||"未能获取图片类型"))}})},fail:()=>{t(new Error("Fail_Cancel"))}})})).then((e=>{this.uploadFile(e)})).catch((o=>{e.index.hideLoading(),console.log(o),"Fail_Cancel"!==o.message&&e.index.showModal({content:`图片上传失败，错误信息为：${o.message}`,showCancel:!1})}))},async uploadFile(o){e.index.showLoading({title:"文件上传中..."});const t=e.tr.importObject("ext-storage-co",{customUI:!0}),i=await t.getUploadFileOptions({cloudPath:`test/${Date.now()}.jpg`});console.log("uploadFileOptionsRes: ",i);e.index.uploadFile({...i.uploadFileOptions,filePath:o.filePath,success:async()=>{const t={cloudPath:i.cloudPath,fileID:i.fileID,fileURL:i.fileURL};if(console.log(t),o.isPrivate){const o=e.tr.importObject("ext-storage-co",{customUI:!0});await o.setFilePrivate({fileID:t.fileID}),this.privateFileID=t.fileID}e.index.showModal({content:"图片上传成功，fileID为："+t.fileID,showCancel:!1})},fail:o=>{console.log(o),"Fail_Cancel"!==o.message&&e.index.showModal({content:`图片上传失败，错误信息为：${o.message}`,showCancel:!1})},complete:()=>{e.index.hideLoading()}}).onProgressUpdate((e=>{console.log("监听上传进度",e)}))},async getTempFileURL(){const o=e.tr.importObject("ext-storage-co");let t=(await o.getTempFileURL({fileList:[this.privateFileID]})).fileList[0].tempFileURL;e.index.showModal({content:"图片临时下载链接为："+t,showCancel:!1})}}};if(!Array){e.resolveComponent("j-link")()}Math;const t=e._export_sfc(o,[["render",function(o,t,i,s,l,a){return e.e({a:e.p({text:"参考",url:"https://uniapp.dcloud.net.cn/uniCloud/publish.html#useinmp"}),b:e.o((e=>a.chooseImage(!1))),c:e.o((e=>a.chooseImage(!0))),d:l.privateFileID},l.privateFileID?{e:e.o((e=>a.getTempFileURL()))}:{})}]]);wx.createPage(t);
